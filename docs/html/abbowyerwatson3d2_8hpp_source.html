<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>Amocurve: abbowyerwatson3d2.hpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Amocurve
   </div>
   <div id="projectbrief">A library for unstructured mesh movement and curved mesh generation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">abbowyerwatson3d2.hpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#ifndef _GLIBCXX_IOSTREAM</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#ifndef _GLIBCXX_FSTREAM</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#ifndef _GLIBCXX_STRING</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#ifndef _GLIBCXX_CMATH</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#ifndef _GLIBCXX_VECTOR</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#ifndef _GLIBCXX_FORWARD_LIST</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#include &lt;forward_list&gt;</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#ifndef __AMATRIX2_H</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="amatrix2_8hpp.html">amatrix2.hpp</a>&gt;</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#ifndef __ADATASTRUCTURES_H</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#include &lt;adatastructures.hpp&gt;</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#define __ABOWYERWATSON3D_H 1</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#ifndef DEBUGBW</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define DEBUGBW 1</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="keyword">using namespace </span>std;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="keyword">using namespace </span>amat;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="keyword">typedef</span> vector&lt;double&gt; <a class="code" href="classPoint.html">Point</a>;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div>
<div class="line"><a name="l00057"></a><span class="lineno"><a class="line" href="structFace.html">   57</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structFace.html">Face</a></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;{</div>
<div class="line"><a name="l00059"></a><span class="lineno"><a class="line" href="structFace.html#a6bf70d054e14f8ee8468b86055f9dadc">   59</a></span>&#160;    <span class="keywordtype">int</span> p[3];           </div>
<div class="line"><a name="l00060"></a><span class="lineno"><a class="line" href="structFace.html#accd8f2dbe3de7e28386f1b850e88dd66">   60</a></span>&#160;    <span class="keywordtype">int</span> elem[2];        </div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="comment">//int lfel[2];      ///&lt; the local face numbers of this face corresponding to the two elements in elem</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;};</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div>
<div class="line"><a name="l00065"></a><span class="lineno"><a class="line" href="classTet.html">   65</a></span>&#160;<span class="keyword">class </span><a class="code" href="classTet.html">Tet</a></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;{</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="keyword">public</span>: </div>
<div class="line"><a name="l00068"></a><span class="lineno"><a class="line" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">   68</a></span>&#160;    <span class="keywordtype">int</span> p[4];           </div>
<div class="line"><a name="l00069"></a><span class="lineno"><a class="line" href="classTet.html#a96866fe360098dd0814fc1f0986991c2">   69</a></span>&#160;    <a class="code" href="classPoint.html">Point</a> <a class="code" href="classTet.html#a96866fe360098dd0814fc1f0986991c2">centre</a>;       </div>
<div class="line"><a name="l00070"></a><span class="lineno"><a class="line" href="classTet.html#a2769d89245abb8ebd79f5ae84586add8">   70</a></span>&#160;    <span class="keywordtype">int</span> surr[4];        </div>
<div class="line"><a name="l00071"></a><span class="lineno"><a class="line" href="classTet.html#ac1cbe6993c0a0804272c5faabc65bc0c">   71</a></span>&#160;    <span class="keywordtype">double</span> <a class="code" href="classTet.html#ac1cbe6993c0a0804272c5faabc65bc0c">D</a>;           </div>
<div class="line"><a name="l00072"></a><span class="lineno"><a class="line" href="classTet.html#a7306f9a3f8047b993f846e2599e814ad">   72</a></span>&#160;    <span class="keywordtype">double</span> <a class="code" href="classTet.html#a7306f9a3f8047b993f846e2599e814ad">radius</a>;      </div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <a class="code" href="classTet.html">Tet</a>() {</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        centre.resize(3,0.0);</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    }</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <a class="code" href="classTet.html">Tet</a>(<span class="keyword">const</span> <a class="code" href="classTet.html">Tet</a>&amp; other) {</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; 4; i++)</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        {</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;            p[i] = other.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[i];</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;            surr[i] = other.<a class="code" href="classTet.html#a2769d89245abb8ebd79f5ae84586add8">surr</a>[i];</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        }</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        centre = other.<a class="code" href="classTet.html#a96866fe360098dd0814fc1f0986991c2">centre</a>;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        D = other.<a class="code" href="classTet.html#ac1cbe6993c0a0804272c5faabc65bc0c">D</a>;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        radius = other.<a class="code" href="classTet.html#a7306f9a3f8047b993f846e2599e814ad">radius</a>;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    }</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;};</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div>
<div class="line"><a name="l00093"></a><span class="lineno"><a class="line" href="structWalkdata.html">   93</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structWalkdata.html">Walkdata</a></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;{</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="keywordtype">int</span> elem;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="keywordtype">double</span> areacoords[4];</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;};</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div>
<div class="line"><a name="l00100"></a><span class="lineno"><a class="line" href="classDelaunay3d.html">  100</a></span>&#160;<span class="keyword">class </span><a class="code" href="classDelaunay3d.html">Delaunay3d</a></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;{</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="keywordtype">int</span> cap;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="keywordtype">int</span> badcap;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="keywordtype">double</span> tol;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <span class="keywordtype">int</span> nnode;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="keywordtype">int</span> ndim;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div>
<div class="line"><a name="l00111"></a><span class="lineno"><a class="line" href="classDelaunay3d.html#aa12fca6f5f1fef721e11f5e87db8cd5f">  111</a></span>&#160;    <span class="keywordtype">double</span> <a class="code" href="classDelaunay3d.html#aa12fca6f5f1fef721e11f5e87db8cd5f">zero_scale</a>;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div>
<div class="line"><a name="l00115"></a><span class="lineno"><a class="line" href="classDelaunay3d.html#a136aede2d375d95773f5156ca3307a12">  115</a></span>&#160;    <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;int&gt;</a> <a class="code" href="classDelaunay3d.html#a136aede2d375d95773f5156ca3307a12">lpofa</a>;</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="keywordtype">void</span> setlpofa();</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;double&gt;</a> points;</div>
<div class="line"><a name="l00120"></a><span class="lineno"><a class="line" href="classDelaunay3d.html#a1da70ba1af9166f5ac574f6d3b19e9b1">  120</a></span>&#160;    std::vector&lt;Point&gt; <a class="code" href="classDelaunay3d.html#a1da70ba1af9166f5ac574f6d3b19e9b1">nodes</a>;       </div>
<div class="line"><a name="l00121"></a><span class="lineno"><a class="line" href="classDelaunay3d.html#a611ff0f25e41d19b4a55a9240c8c92ee">  121</a></span>&#160;    <a class="code" href="classPList.html">PList&lt;Tet&gt;</a> <a class="code" href="classDelaunay3d.html#a611ff0f25e41d19b4a55a9240c8c92ee">elems</a>;           </div>
<div class="line"><a name="l00122"></a><span class="lineno"><a class="line" href="classDelaunay3d.html#ab7b8a0611c2018eaf7c4ca1d2fe71504">  122</a></span>&#160;    std::vector&lt;int&gt; <a class="code" href="classDelaunay3d.html#ab7b8a0611c2018eaf7c4ca1d2fe71504">badelems</a>;      </div>
<div class="line"><a name="l00123"></a><span class="lineno"><a class="line" href="classDelaunay3d.html#a4f7e267a3743c5c48bde1bc9f85064ba">  123</a></span>&#160;    <a class="code" href="classPList.html">PList&lt;Face&gt;</a> <a class="code" href="classDelaunay3d.html#a4f7e267a3743c5c48bde1bc9f85064ba">faces</a>;      </div>
<div class="line"><a name="l00124"></a><span class="lineno"><a class="line" href="classDelaunay3d.html#aecc133c027972c6093f625ec0e8242d2">  124</a></span>&#160;    std::vector&lt;int&gt; <a class="code" href="classDelaunay3d.html#aecc133c027972c6093f625ec0e8242d2">voidpoly</a>;      </div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;double&gt;</a> jacobians;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="keywordtype">int</span> npoints;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <a class="code" href="classDelaunay3d.html">Delaunay3d</a>();</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <a class="code" href="classDelaunay3d.html">Delaunay3d</a>(<a class="code" href="classamat_1_1Matrix.html">Matrix&lt;double&gt;</a>* _points, <span class="keywordtype">int</span> num_points);</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <a class="code" href="classDelaunay3d.html">Delaunay3d</a>(<span class="keyword">const</span> <a class="code" href="classDelaunay3d.html">Delaunay3d</a>&amp; other);</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <a class="code" href="classDelaunay3d.html">Delaunay3d</a>&amp; operator=(<span class="keyword">const</span> <a class="code" href="classDelaunay3d.html">Delaunay3d</a>&amp; other);</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="keywordtype">void</span> setup(<a class="code" href="classamat_1_1Matrix.html">Matrix&lt;double&gt;</a>* _points, <span class="keywordtype">int</span> num_points);</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    </div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="keywordtype">double</span> l2norm(<span class="keyword">const</span> vector&lt;double&gt;&amp; a) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    </div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="keywordtype">double</span> dot(<span class="keyword">const</span> vector&lt;double&gt;&amp; a, <span class="keyword">const</span> vector&lt;double&gt;&amp; b) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    </div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="keywordtype">double</span> det4(<span class="keyword">const</span> <span class="keywordtype">int</span> ielem, <span class="keyword">const</span> <span class="keywordtype">int</span> i, <span class="keyword">const</span> vector&lt;double&gt;&amp; r) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    </div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="keywordtype">void</span> compute_jacobian(<a class="code" href="classTet.html">Tet</a>&amp; elem);</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    </div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="keywordtype">void</span> cross_product3(vector&lt;double&gt;&amp; c, <span class="keyword">const</span> vector&lt;double&gt;&amp; a, <span class="keyword">const</span> vector&lt;double&gt;&amp; b) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    </div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="keywordtype">void</span> compute_circumsphere(<a class="code" href="classTet.html">Tet</a>&amp; elem);</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="keywordtype">void</span> compute_circumsphere_contra(<a class="code" href="classTet.html">Tet</a>&amp; elem);</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    </div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="keywordtype">double</span> tetvol(<span class="keyword">const</span> vector&lt;double&gt;&amp; a, <span class="keyword">const</span> vector&lt;double&gt;&amp; b, <span class="keyword">const</span> vector&lt;double&gt;&amp; c, <span class="keyword">const</span> vector&lt;double&gt;&amp; d) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    </div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="keywordtype">int</span> find_containing_tet_old(<span class="keyword">const</span> vector&lt;double&gt;&amp; r, <span class="keyword">const</span> <span class="keywordtype">int</span> startelement) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="keywordtype">int</span> find_containing_tet(<span class="keyword">const</span> vector&lt;double&gt;&amp; r, <span class="keyword">const</span> <span class="keywordtype">int</span> startelement) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    </div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="keywordtype">int</span> check_face_tet(<span class="keyword">const</span> <a class="code" href="classTet.html">Tet</a>&amp; elem, <span class="keyword">const</span> <a class="code" href="structFace.html">Face</a>&amp; face) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="keywordtype">void</span> bowyer_watson();</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    </div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="keywordtype">void</span> clear();                   </div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    </div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <span class="keywordtype">void</span> writeGmsh2(<span class="keyword">const</span> <span class="keywordtype">string</span> mfile) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    </div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <a class="code" href="structWalkdata.html">Walkdata</a> find_containing_tet_and_barycentric_coords(<span class="keyword">const</span> vector&lt;double&gt;&amp; rr, <span class="keyword">const</span> <span class="keywordtype">int</span> startelement) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    </div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    <span class="keywordtype">void</span> compute_jacobians();</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    </div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <span class="keywordtype">bool</span> detect_negative_jacobians() <span class="keyword">const</span>;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="keywordtype">void</span> write_jacobians(<span class="keyword">const</span> <span class="keywordtype">string</span> fname) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;};</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="keywordtype">void</span> Delaunay3d::setlpofa()</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;{</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    lpofa.setup(nnode,nnode-1);</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    lpofa(0,0) = 1; lpofa(0,1) = 2; lpofa(0,2) = 3;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    lpofa(1,0) = 2; lpofa(1,1) = 0; lpofa(1,2) = 3;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    lpofa(2,0) = 3; lpofa(2,1) = 0; lpofa(2,2) = 1;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    lpofa(3,0) = 0; lpofa(3,1) = 2; lpofa(3,2) = 1;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;}</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;Delaunay3d::Delaunay3d() </div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;{</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    nnode = 4;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    ndim = 3;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    cap = 1000;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    badcap = 50;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    tol = 1e-10;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    elems.reserve(cap);</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    faces.reserve(cap);</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    cout &lt;&lt; setprecision(12);</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    setlpofa();</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;}</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;Delaunay3d::Delaunay3d(<a class="code" href="classamat_1_1Matrix.html">Matrix&lt;double&gt;</a>* _points, <span class="keywordtype">int</span> num_points)</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;{</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    nnode = 4;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    ndim = 3;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    cap = 1000;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    badcap = 50;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    tol = 1e-10;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    elems.reserve(cap);</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    faces.reserve(cap);</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    points = *_points;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    npoints = num_points;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    nodes.reserve(num_points+3);</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    setlpofa();</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    cout &lt;&lt; setprecision(12);</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;}</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;Delaunay3d::Delaunay3d(<span class="keyword">const</span> <a class="code" href="classDelaunay3d.html">Delaunay3d</a>&amp; other)</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;{</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    cap = other.cap;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    badcap = other.badcap;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    tol = other.tol;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    nnode = other.nnode;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    ndim = other.ndim;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    points = other.points;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    nodes = other.<a class="code" href="classDelaunay3d.html#a1da70ba1af9166f5ac574f6d3b19e9b1">nodes</a>;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    elems = other.<a class="code" href="classDelaunay3d.html#a611ff0f25e41d19b4a55a9240c8c92ee">elems</a>;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    faces = other.<a class="code" href="classDelaunay3d.html#a4f7e267a3743c5c48bde1bc9f85064ba">faces</a>;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    jacobians = other.jacobians;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    npoints = other.npoints;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    setlpofa();</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;}</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<a class="code" href="classDelaunay3d.html">Delaunay3d</a>&amp; Delaunay3d::operator=(<span class="keyword">const</span> <a class="code" href="classDelaunay3d.html">Delaunay3d</a>&amp; other)</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;{</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    cap = other.cap;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    badcap = other.badcap;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    tol = other.tol;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    nnode = other.nnode;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    ndim = other.ndim;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    points = other.points;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    nodes = other.<a class="code" href="classDelaunay3d.html#a1da70ba1af9166f5ac574f6d3b19e9b1">nodes</a>;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    elems = other.<a class="code" href="classDelaunay3d.html#a611ff0f25e41d19b4a55a9240c8c92ee">elems</a>;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    faces = other.<a class="code" href="classDelaunay3d.html#a4f7e267a3743c5c48bde1bc9f85064ba">faces</a>;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    jacobians = other.jacobians;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    npoints = other.npoints;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    setlpofa();</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;}</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="keywordtype">void</span> Delaunay3d::setup(<a class="code" href="classamat_1_1Matrix.html">Matrix&lt;double&gt;</a>* _points, <span class="keywordtype">int</span> num_points)</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;{</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    nnode = 4;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    ndim = 3;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    cap = 1000;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    badcap = 50;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    tol = 1e-10;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    elems.reserve(cap);</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    faces.reserve(cap);</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    points = *_points;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    npoints = num_points;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    nodes.reserve(num_points+3);</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    setlpofa();</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    cout &lt;&lt; setprecision(12);</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;}</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div>
<div class="line"><a name="l00265"></a><span class="lineno"><a class="line" href="classDelaunay3d.html#a2c231a91c2ecf486f41c65ff7e6dd8c7">  265</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="classDelaunay3d.html#a2c231a91c2ecf486f41c65ff7e6dd8c7">Delaunay3d::tetvol</a>(<span class="keyword">const</span> vector&lt;double&gt;&amp; a, <span class="keyword">const</span> vector&lt;double&gt;&amp; b, <span class="keyword">const</span> vector&lt;double&gt;&amp; c, <span class="keyword">const</span> vector&lt;double&gt;&amp; d)<span class="keyword"> const</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="keywordtype">double</span> x1, y1, z1, x21, y21, z21, x31, y31, z31, x41, y41, z41;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    x1 = a[0]; y1 = a[1]; z1 = a[2];</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    x21 = b[0] - x1;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    y21 = b[1] - y1;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    z21 = b[2] - z1;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    x31 = c[0] - x1;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    y31 = c[1] - y1;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    z31 = c[2] - z1;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    x41 = d[0] - x1;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    y41 = d[1] - y1;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    z41 = d[2] - z1;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <span class="keywordflow">return</span> x21*(y31*z41-z31*y41) + x31*(z21*y41-y21*z41) + x41*(y21*z31-z21*y31);</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;}</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div>
<div class="line"><a name="l00286"></a><span class="lineno"><a class="line" href="classDelaunay3d.html#a096cf0a463d63b968018a2c22f9f99cb">  286</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classDelaunay3d.html#a096cf0a463d63b968018a2c22f9f99cb">Delaunay3d::compute_jacobian</a>(<a class="code" href="classTet.html">Tet</a>&amp; elem)</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;{   </div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    elem.<a class="code" href="classTet.html#ac1cbe6993c0a0804272c5faabc65bc0c">D</a> = tetvol(nodes[elem.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[0]],nodes[elem.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[1]],nodes[elem.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[2]],nodes[elem.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[3]]);</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;}</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div>
<div class="line"><a name="l00292"></a><span class="lineno"><a class="line" href="classDelaunay3d.html#af0c09e767b2fff2d909a80b37bb57ca4">  292</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classDelaunay3d.html#af0c09e767b2fff2d909a80b37bb57ca4">Delaunay3d::cross_product3</a>(vector&lt;double&gt;&amp; c, <span class="keyword">const</span> vector&lt;double&gt;&amp; a, <span class="keyword">const</span> vector&lt;double&gt;&amp; b)<span class="keyword"> const</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    c[0] = a[1]*b[2]-a[2]*b[1];</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    c[1] = a[2]*b[0]-a[0]*b[2];</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    c[2] = a[0]*b[1]-a[1]*b[0];</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;}</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;</div>
<div class="line"><a name="l00300"></a><span class="lineno"><a class="line" href="classDelaunay3d.html#af87e9ce75e735e325bfde3c6df5b91a3">  300</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">double</span> <a class="code" href="classDelaunay3d.html#af87e9ce75e735e325bfde3c6df5b91a3">Delaunay3d::dot</a>(<span class="keyword">const</span> vector&lt;double&gt;&amp; a, <span class="keyword">const</span> vector&lt;double&gt;&amp; b)<span class="keyword"> const</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="keywordtype">double</span> val = 0;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; ndim; i++)</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        val += a[i]*b[i];</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <span class="keywordflow">return</span> val;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;}</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;</div>
<div class="line"><a name="l00309"></a><span class="lineno"><a class="line" href="classDelaunay3d.html#a9e5372b14b21c65de51388d2551d7f68">  309</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">double</span> <a class="code" href="classDelaunay3d.html#a9e5372b14b21c65de51388d2551d7f68">Delaunay3d::l2norm</a>(<span class="keyword">const</span> vector&lt;double&gt;&amp; a)<span class="keyword"> const</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="comment">// a.size() should ideally equal ndim</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <span class="keywordtype">double</span> norm = 0;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; a.size(); i++)</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        norm += a[i]*a[i];</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    norm = sqrt(norm);</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="keywordflow">return</span> norm;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;}</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;</div>
<div class="line"><a name="l00320"></a><span class="lineno"><a class="line" href="classDelaunay3d.html#a29fcc2ab4187bcdee2a9b0481cfee87b">  320</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classDelaunay3d.html#a29fcc2ab4187bcdee2a9b0481cfee87b">Delaunay3d::compute_circumsphere</a>(<a class="code" href="classTet.html">Tet</a>&amp; elem)</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;{</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="comment">// normals to the perp bisectors of 3 non-coplanar edges of the tet</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;double&gt;</a> normal(ndim,ndim), rhs(ndim,1);</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    <span class="comment">// jth component of midpoint of an edge</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <span class="keywordtype">double</span> midpointj;</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="keywordtype">int</span> i,j,k;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <span class="keywordflow">for</span>(i = 0; i &lt; ndim; i++)       <span class="comment">// loop over three non-coplanar edges of the tet</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    {</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        <span class="keywordflow">for</span>(j = 0; j &lt; ndim; j++)</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;            normal(i,j) = nodes[elem.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[i+1]][j] - nodes[elem.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[0]][j];</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        </div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        rhs(i) = 0;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        <span class="keywordflow">for</span>(j = 0; j &lt; ndim; j++) </div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        {</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;            midpointj = (nodes[elem.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[i+1]][j]+nodes[elem.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[0]][j])/2.0;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;            rhs(i) += normal(i,j)*midpointj;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;        }</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    }</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="comment">// solve the linear system by Cramer&#39;s rule to get coords of the circumcentre</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    vector&lt;double&gt; rc(ndim);</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;double&gt;</a> numer(ndim,ndim);</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <span class="keywordtype">double</span> detnum;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <span class="comment">//double detdenom = determinant(normal);</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <span class="keywordtype">double</span> detdenom = 0;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    detdenom = normal(0,0)*( normal(1,1)*normal(2,2)-normal(1,2)*normal(2,1) ) -normal(0,1)*( normal(1,0)*normal(2,2)-normal(1,2)*normal(2,0)) </div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        +normal(0,2)*( normal(1,0)*normal(2,1)-normal(1,1)*normal(2,0));</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="preprocessor">#if DEBUGBW==1</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span>(fabs(detdenom) &lt; ZERO_TOL) cout &lt;&lt; <span class="stringliteral">&quot;Delaunay3d: compute_circumsphere(): ! System is inconsistent!! Jacobian of elem is &quot;</span> &lt;&lt; elem.<a class="code" href="classTet.html#ac1cbe6993c0a0804272c5faabc65bc0c">D</a> &lt;&lt; endl;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;#endif</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    </div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <span class="keywordflow">for</span>(k = 0; k &lt; ndim; k++)</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    {</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        <span class="keywordflow">for</span>(j = 0; j &lt; ndim; j++)</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        {</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;            <span class="keywordflow">if</span>(j == k) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;            <span class="keywordflow">for</span>(i = 0; i &lt; ndim; i++)</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                numer(i,j) = normal.get(i,j);</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        }</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        <span class="keywordflow">for</span>(i = 0; i &lt; ndim; i++)</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;            numer(i,k) = rhs.get(i);</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        </div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        detnum = numer(0,0)*( numer(1,1)*numer(2,2)-numer(1,2)*numer(2,1) ) -numer(0,1)*( numer(1,0)*numer(2,2)-numer(1,2)*numer(2,0)) +numer(0,2)*( numer(1,0)*numer(2,1)-numer(1,1)*numer(2,0));</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        <span class="comment">//detnum = determinant(numer);</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        rc[k] = detnum/detdenom;</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    }</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    elem.<a class="code" href="classTet.html#a96866fe360098dd0814fc1f0986991c2">centre</a> = rc;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    elem.<a class="code" href="classTet.html#a7306f9a3f8047b993f846e2599e814ad">radius</a> = 0.0;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    </div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <span class="comment">// now calculate radius squared</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <span class="keywordflow">for</span>(j = 0; j &lt; ndim; j++)</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        elem.<a class="code" href="classTet.html#a7306f9a3f8047b993f846e2599e814ad">radius</a> += (rc[j]-nodes[elem.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[0]][j])*(rc[j]-nodes[elem.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[0]][j]);</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    <span class="comment">//elem.radius = sqrt(elem.radius);</span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <span class="comment">// check</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <span class="comment">/*Matrix&lt;double&gt; rhstest(ndim,1); rhstest.zeros();</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="comment">    for(i = 0; i &lt; ndim; i++)</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="comment">        for(j = 0; j &lt; ndim; j++)</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="comment">            rhstest(i) += normal(i,j)*rc[j];</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment">    </span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="comment">    rhstest.mprint();</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="comment">    rhs.mprint();</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="comment">    cout &lt;&lt; &quot;Circumsphere data : centre &quot; &lt;&lt; elem.centre[0] &lt;&lt; &quot;,&quot; &lt;&lt; elem.centre[1] &lt;&lt; &quot;,&quot; &lt;&lt; elem.centre[2] &lt;&lt; &quot;, radius^2 &quot; &lt;&lt; elem.radius &lt;&lt; endl;</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="comment">    cout &lt;&lt; &quot;Delaunay3d: compute_circumsphere(): Element jacobian = &quot; &lt;&lt; elem.D &lt;&lt; endl;*/</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;}</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="keywordtype">void</span> Delaunay3d::compute_circumsphere_contra(<a class="code" href="classTet.html">Tet</a>&amp; elem)</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;{</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    vector&lt;double&gt; g1(ndim), g2(ndim), nrm(ndim),  g2co(ndim), cold(ndim), rdiff(ndim), rave(ndim);</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <span class="keywordtype">double</span> tp, tpd;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="keywordtype">int</span> k;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    </div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <span class="keywordflow">for</span>(k = 0; k &lt; ndim; k++)</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    {</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        g1[k] = nodes[elem.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[1]][k] - nodes[elem.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[0]][k];</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        g2[k] = nodes[elem.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[2]][k] - nodes[elem.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[0]][k];</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    }</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    </div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <span class="comment">// normal vector to &quot;base&quot; face 0-1-2</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    nrm[0] = g1[1]*g2[2] - g1[2]*g2[1];</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    nrm[1] = g1[2]*g2[0] - g1[0]*g2[2];</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    nrm[2] = g1[0]*g2[1] - g1[1]*g2[0];</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    </div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <span class="comment">// normalize the normal vector</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <span class="keywordtype">double</span> normnrm = 0;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <span class="keywordflow">for</span>(k = 0; k &lt; ndim; k++)</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        normnrm += nrm[k]*nrm[k];</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    </div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="preprocessor">    #if DEBUGBW==1</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span>(normnrm &lt; ZERO_TOL) cout &lt;&lt; <span class="stringliteral">&quot;Delaunay3d: compute_circumsphere_contra(): ! Element is degenerate!!&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="preprocessor">    #endif</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;<span class="preprocessor"></span>    </div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    normnrm = 1.0/sqrt(normnrm);</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    <span class="keywordflow">for</span>(k = 0; k &lt; ndim; k++)</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        nrm[k] *= normnrm;</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    </div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    <span class="comment">// &quot;contravariant&quot; vector g2co = nrm _cross_ g1</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    g2co[0] = nrm[1]*g1[2] - nrm[2]*g1[1];</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    g2co[1] = nrm[2]*g1[0] - nrm[0]*g1[2];</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    g2co[2] = nrm[0]*g1[1] - nrm[1]*g1[0];</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    <span class="comment">// compute &quot;factor t for base&quot;, ie, tp</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    tpd = 0;</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    tp = 0;</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    <span class="keywordflow">for</span>(k = 0; k &lt; ndim; k++)</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    {</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        tpd += g2co[k]*g2[k];</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        tp += (g2[k]-g1[k])*g2[k];</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    }</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    tp = 0.5 * tp / tpd;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <span class="comment">// circumcentre of base face</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <span class="keywordflow">for</span>(k = 0; k &lt; ndim; k++)</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;        cold[k] = nodes[elem.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[0]][k] + 0.5*g1[k] + tp*g2co[k];</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    </div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <span class="comment">// now average and difference of node 3 (the final node, not part of the base face) and node 0</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    <span class="keywordflow">for</span>(k = 0; k &lt; ndim; k++)</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    {</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        rdiff[k] = nodes[elem.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[3]][k] - nodes[elem.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[0]][k];</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        rave[k] = 0.5*( nodes[elem.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[3]][k] + nodes[elem.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[0]][k] );</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    }</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <span class="comment">// final t parameter</span></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    tpd = 0; tp = 0;</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <span class="keywordflow">for</span>(k = 0; k &lt; ndim; k++)</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    {</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        tpd += nrm[k]*rdiff[k];</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        tp += (rave[k]-cold[k])*rdiff[k];</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    }</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    tp = tp/tpd;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <span class="comment">// finally, the circumcentre</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <span class="keywordflow">for</span>(k = 0; k &lt; ndim; k++)</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        elem.<a class="code" href="classTet.html#a96866fe360098dd0814fc1f0986991c2">centre</a>[k] = cold[k] + tp*nrm[k];</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    </div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    <span class="comment">// square of radius</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    elem.<a class="code" href="classTet.html#a7306f9a3f8047b993f846e2599e814ad">radius</a> = 0;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <span class="keywordflow">for</span>(k = 0; k &lt; ndim; k++)</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;        elem.<a class="code" href="classTet.html#a7306f9a3f8047b993f846e2599e814ad">radius</a> += (elem.<a class="code" href="classTet.html#a96866fe360098dd0814fc1f0986991c2">centre</a>[k] - nodes[elem.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[0]][k])*(elem.<a class="code" href="classTet.html#a96866fe360098dd0814fc1f0986991c2">centre</a>[k] - nodes[elem.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[0]][k]);</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    <span class="comment">//elem.radius = sqrt(elem.radius);</span></div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    </div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="comment">//cout &lt;&lt; &quot;Circumsphere data : centre &quot; &lt;&lt; elem.centre[0] &lt;&lt; &quot;,&quot; &lt;&lt; elem.centre[1] &lt;&lt; &quot;,&quot; &lt;&lt; elem.centre[2] &lt;&lt; &quot;, radius^2 &quot; &lt;&lt; elem.radius &lt;&lt; endl;</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="comment">//cout &lt;&lt; &quot;Delaunay3d: compute_circumsphere_contra(): Element jacobian = &quot; &lt;&lt; elem.D &lt;&lt; endl;</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;}</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;</div>
<div class="line"><a name="l00475"></a><span class="lineno"><a class="line" href="classDelaunay3d.html#ab9e7887ccfacfa787f73c16650c1b7c6">  475</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="classDelaunay3d.html#ab9e7887ccfacfa787f73c16650c1b7c6">Delaunay3d::det4</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> ielem, <span class="keyword">const</span> <span class="keywordtype">int</span> i, <span class="keyword">const</span> vector&lt;double&gt;&amp; r)<span class="keyword"> const</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="preprocessor">    #if DEBUGBW==1</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span>(i &gt; 3) {</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;Delaunay3D: det4(): ! Second argument is greater than 3!&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    }</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="preprocessor">    #endif</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <a class="code" href="classTet.html">Tet</a> elem = elems[ielem];</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    vector&lt;double&gt; ta[4];</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j = 0; j &lt; nnode; j++)</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;        ta[j] = nodes[elem.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[j]];</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    ta[i] = r;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <span class="keywordflow">return</span> tetvol(ta[0],ta[1],ta[2],ta[3]);</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;}</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;</div>
<div class="line"><a name="l00500"></a><span class="lineno"><a class="line" href="classDelaunay3d.html#ac0102c73f3df68e39f54d7f321286c6e">  500</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classDelaunay3d.html#ac0102c73f3df68e39f54d7f321286c6e">Delaunay3d::find_containing_tet_old</a>(<span class="keyword">const</span> vector&lt;double&gt;&amp; xx, <span class="keyword">const</span> <span class="keywordtype">int</span> startelement)<span class="keyword"> const</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <span class="keywordflow">if</span>(xx.size() &lt; ndim) {</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;Delaunau3D: find_containing_triangle(): ! Input vector is not long enough!\n&quot;</span>;</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    }</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    <span class="keywordtype">int</span> ielem = startelement;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    <a class="code" href="classTet.html">Tet</a> super;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <span class="keywordtype">double</span> l;</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    <span class="keywordtype">bool</span> found;</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    </div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    <span class="comment">//while(1)</span></div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ii = 0; ii &lt; elems.size()+3; ii++)</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    {</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;        <span class="comment">//cout &lt;&lt; &quot; +&quot; &lt;&lt; ielem;</span></div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;        found = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        <span class="keywordflow">if</span>(ielem &lt; 0 || ielem &gt;= elems.size()) { cout &lt;&lt; <span class="stringliteral">&quot;Delaunay3d:   !! Reached an element index that is out of bounds!! Index is &quot;</span> &lt;&lt; ielem &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>; <span class="keywordflow">return</span> ielem; }</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        super = elems[ielem];</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> inode = 0; inode &lt; nnode; inode++)</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;        {</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;            <span class="comment">// get jacobian</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;            l = det4(ielem,inode,xx);</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;<span class="preprocessor">            #if DEBUGBW==1</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;<span class="preprocessor"></span>            <span class="comment">//if(dabs(l) &lt; ZERO_TOL) cout &lt;&lt; &quot;Delaunay3d: find_containing_tet(): ! Degenerate case (type 1) &quot; &lt;&lt; inode &lt;&lt; &quot;!!\n&quot;;</span></div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="preprocessor">            #endif</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="preprocessor"></span>            <span class="keywordflow">if</span>(l/super.<a class="code" href="classTet.html#ac1cbe6993c0a0804272c5faabc65bc0c">D</a> &lt; 0)</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;            {</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;                ielem = super.<a class="code" href="classTet.html#a2769d89245abb8ebd79f5ae84586add8">surr</a>[inode];</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;                found = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;            }</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;        }</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;        <span class="comment">// if all 4 area-ratios are positive, we&#39;ve found our element</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;        <span class="keywordflow">if</span>(found) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    }</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <span class="comment">//cout &lt;&lt; &quot;Delaunay3D:   Containing tet found as &quot; &lt;&lt; ielem &lt;&lt; endl;</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    <span class="keywordflow">return</span> ielem;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;}</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;</div>
<div class="line"><a name="l00549"></a><span class="lineno"><a class="line" href="classDelaunay3d.html#a82f9c728e3ba3de9eb234dee65ae3b16">  549</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classDelaunay3d.html#a82f9c728e3ba3de9eb234dee65ae3b16">Delaunay3d::find_containing_tet</a>(<span class="keyword">const</span> vector&lt;double&gt;&amp; xx, <span class="keyword">const</span> <span class="keywordtype">int</span> startelement)<span class="keyword"> const</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    <span class="keywordflow">if</span>(xx.size() &lt; ndim) {</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;Delaunau3D: find_containing_triangle(): ! Input vector is not long enough!\n&quot;</span>;</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    }</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    <span class="keywordtype">int</span> ielem = startelement;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    <a class="code" href="classTet.html">Tet</a> super;</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    <span class="keywordtype">double</span> l, minl; <span class="keywordtype">int</span> minln, ii;</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    <span class="keywordtype">bool</span> found = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    </div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    <span class="keywordflow">for</span>(ii = 0; ii &lt; elems.size()+3; ii++)</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    {</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;        <span class="keywordflow">if</span>(ielem &lt; 0 || ielem &gt;= elems.size()) { cout &lt;&lt; <span class="stringliteral">&quot;Delaunay3d:   !! Reached an element index that is out of bounds!! Index is &quot;</span> &lt;&lt; ielem &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>; <span class="keywordflow">return</span> ielem; }</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;        super = elems[ielem];</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;        minl = 1.0;</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> inode = 0; inode &lt; nnode; inode++)</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;        {</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;            <span class="comment">// get jacobian ratio</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;            l = det4(ielem,inode,xx)/super.<a class="code" href="classTet.html#ac1cbe6993c0a0804272c5faabc65bc0c">D</a>;</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;            <span class="keywordflow">if</span>(minl &gt; l)</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;            {</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;                minl = l;</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;                minln = inode;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;            }</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;        }</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        <span class="keywordflow">if</span>(minl &gt;= 0)</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        ielem = super.<a class="code" href="classTet.html#a2769d89245abb8ebd79f5ae84586add8">surr</a>[minln];</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    }</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;<span class="preprocessor">#if DEBUGBW==1</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;<span class="preprocessor"></span>    <span class="keywordflow">if</span>(ii == elems.size()+3)</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;Delaunay3d: find_containing_tet(): !! Could not find host element!&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    <span class="comment">//cout &lt;&lt; &quot;Delaunay3D:   Containing tet found as &quot; &lt;&lt; ielem &lt;&lt; endl;</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    <span class="keywordflow">return</span> ielem;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;}</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;</div>
<div class="line"><a name="l00595"></a><span class="lineno"><a class="line" href="classDelaunay3d.html#aab9796c1c3cf7aafb89fdcb407695923">  595</a></span>&#160;<span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="classDelaunay3d.html#aab9796c1c3cf7aafb89fdcb407695923">Delaunay3d::check_face_tet</a>(<span class="keyword">const</span> <a class="code" href="classTet.html">Tet</a>&amp; elem, <span class="keyword">const</span> <a class="code" href="structFace.html">Face</a>&amp; face)<span class="keyword"> const</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    <span class="comment">// iterate over each face of elem</span></div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <span class="comment">/*for(int i = 0; i &lt; 4; i++)</span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;<span class="comment">    {</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;<span class="comment">        // check all 6 permutations by which elem&#39;s ith face could be same as the input face.</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;<span class="comment">        if(face.p[0]==elem.p[(0+i)%4] &amp;&amp; face.p[1]==elem.p[(1+i)%4] &amp;&amp; face.p[2]==elem.p[(2+i)%4]) return (3+i)%4;</span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;<span class="comment">        if(face.p[0]==elem.p[(0+i)%4] &amp;&amp; face.p[1]==elem.p[(2+i)%4] &amp;&amp; face.p[2]==elem.p[(1+i)%4]) return (3+i)%4;</span></div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;<span class="comment">        if(face.p[0]==elem.p[(1+i)%4] &amp;&amp; face.p[1]==elem.p[(0+i)%4] &amp;&amp; face.p[2]==elem.p[(2+i)%4]) return (3+i)%4;</span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;<span class="comment">        if(face.p[0]==elem.p[(1+i)%4] &amp;&amp; face.p[1]==elem.p[(2+i)%4] &amp;&amp; face.p[2]==elem.p[(0+i)%4]) return (3+i)%4;</span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;<span class="comment">        if(face.p[0]==elem.p[(2+i)%4] &amp;&amp; face.p[1]==elem.p[(0+i)%4] &amp;&amp; face.p[2]==elem.p[(1+i)%4]) return (3+i)%4;</span></div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;<span class="comment">        if(face.p[0]==elem.p[(2+i)%4] &amp;&amp; face.p[1]==elem.p[(1+i)%4] &amp;&amp; face.p[2]==elem.p[(0+i)%4]) return (3+i)%4;</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;<span class="comment">    return -1;*/</span></div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    </div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    <span class="keywordtype">int</span> i,j,k;</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    <span class="comment">// iterate over local faces of the element</span></div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    <span class="keywordflow">for</span>(i = 0; i &lt; nnode; i++)</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    {</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;        <span class="keywordtype">bool</span> foundf = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;        <span class="comment">// iterate over nodes of the element&#39;s face</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;        <span class="keywordflow">for</span>(k = 1; k &lt; nnode; k++)  </div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;        {</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;            <span class="keywordtype">bool</span> found = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;            <span class="comment">// iterate over nodes of the face to be tested</span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;            <span class="keywordflow">for</span>(j = 0; j &lt; nnode-1; j++)</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;            {</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;                <span class="keywordflow">if</span>(elem.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[(i+k) % nnode] == face.<a class="code" href="structFace.html#a6bf70d054e14f8ee8468b86055f9dadc">p</a>[j])</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;                {</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;                    found = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;                }</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;            }</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;            <span class="comment">// if none of the face&#39;s nodes match the element&#39;s ith face&#39;s kth node, the ith face is not the one we&#39;re looking for</span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;            <span class="keywordflow">if</span>(!found) </div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;            {</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;                foundf = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;            }</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;        }</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;        <span class="keywordflow">if</span>(foundf) <span class="keywordflow">return</span> i;</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    }</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;}</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;</div>
<div class="line"><a name="l00648"></a><span class="lineno"><a class="line" href="classDelaunay3d.html#a7bee4058767627eccd7b1e400ed69f92">  648</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classDelaunay3d.html#a7bee4058767627eccd7b1e400ed69f92">Delaunay3d::bowyer_watson</a>()</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;{</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    <span class="comment">// first, add super triangle</span></div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    </div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    <span class="comment">//  find minimum and maximum x and y of the point set</span></div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    <span class="comment">//  scalef contains scaling factors for each direction</span></div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    vector&lt;double&gt; rmin(ndim,0), rmax(ndim,0), scalef(ndim);</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; npoints; i++)</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    {</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> idim = 0; idim &lt; ndim; idim++) </div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;        {</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;            <span class="keywordflow">if</span>(points(i,idim) &gt; rmax[idim]) rmax[idim] = points(i,idim);</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;            <span class="keywordflow">if</span>(points(i,idim) &lt; rmin[idim]) rmin[idim] = points(i,idim);</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;        }</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    }</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    </div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;Bounds of the point set are &quot;</span>;</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> idim = 0; idim &lt; ndim; idim++)</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; rmin[idim] &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; rmax[idim] &lt;&lt; endl;</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;**\n&quot;</span>;</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    <span class="comment">// scale the point coordinates</span></div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    </div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> idim = 0; idim &lt; ndim; idim++)</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    {</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;        scalef[idim] = (fabs(rmax[idim]) &gt; fabs(rmin[idim])) ? fabs(rmax[idim]) : fabs(rmin[idim]);</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    }</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;Scaling factors\n&quot;</span>;</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> idim = 0; idim &lt; ndim; idim++)</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; scalef[idim];</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    cout &lt;&lt; endl;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; npoints; i++)</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> idim = 0; idim &lt; ndim; idim++)</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;            points(i,idim) /= scalef[idim];</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    <span class="comment">// now re-compute limits</span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; npoints; i++)</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    {</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> idim = 0; idim &lt; ndim; idim++) </div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;        {</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;            <span class="keywordflow">if</span>(points(i,idim) &gt; rmax[idim]) rmax[idim] = points(i,idim);</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;            <span class="keywordflow">if</span>(points(i,idim) &lt; rmin[idim]) rmin[idim] = points(i,idim);</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;        }</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    }</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    <span class="comment">// factor by which to scale rdelt, for providing a factor of safety.</span></div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    <span class="keywordtype">double</span> factor = 0.5;</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;    </div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    vector&lt;double&gt; rdelt(ndim);     <span class="comment">// stores some extra length to have factor of safety in deciding the first 4 points</span></div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> idim = 0; idim &lt; ndim; idim++){</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;        rdelt[idim] = A_SMALL_NUMBER + factor*(rmax[idim]-rmin[idim]);</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;        rmax[idim] += rdelt[idim];</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;        rmin[idim] -= rdelt[idim];</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    }</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;Bounds of the extended cuboid (after scaling) are &quot;</span>;</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> idim = 0; idim &lt; ndim; idim++)</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; rmin[idim] &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; rmax[idim] &lt;&lt; endl;</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;**\n&quot;</span>;</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    <span class="comment">// now rmax and rmin denote the expanse of a cuboid that contains all the points.</span></div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    <a class="code" href="classTet.html">Tet</a> super;</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    vector&lt;Point&gt; pp(nnode);</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; nnode; i++)</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;        pp[i].resize(ndim);</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    pp[0][0] = rmin[0] - (rmax[2]-rmin[2])*0.5 - (rmax[1]-rmin[1]);</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    pp[0][1] = rmin[1];</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;    pp[0][2] = (rmax[2]+rmin[2])*0.5;</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;    pp[1][0] = rmax[0] + rmax[1] - rmin[1];</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    pp[1][1] = rmin[1];</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;    pp[1][2] = rmax[2] + rmax[0]-rmin[0] + 2.0*(rmax[1]-rmin[1]);</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    pp[2][0] = rmax[0] + rmax[1] - rmin[1];</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    pp[2][1] = rmin[1];</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    pp[2][2] = rmin[2] - (rmax[0]-rmin[0]) - 2.0*(rmax[1]-rmin[1]);</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    pp[3][0] = 0.5*(rmax[0]+rmin[0]) - 0.25*(rmax[2]-rmin[2]);</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    pp[3][1] = 0.5*(rmax[0]-rmin[0]) + 0.25*(rmax[2]-rmin[2]) + rmax[1];</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    pp[3][2] = 0.5*(rmax[2] + rmin[2]);</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    </div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    <span class="comment">/*pp[0][0] = -10; pp[0][1] = -2; pp[0][2] = 2;</span></div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;<span class="comment">    pp[1][0] = 0; pp[1][1] = 8; pp[1][2] = 0;</span></div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;<span class="comment">    pp[2][0] = 10; pp[2][1] = -2; pp[2][2] = 2;</span></div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;<span class="comment">    pp[3][0] = 0; pp[3][1] = -2; pp[3][2] = -8;*/</span></div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;Delaunay3d: bowyer_watson(): Coordinates of vertices of the super triangle are:\n&quot;</span>;</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> inode = 0; inode &lt; nnode; inode++)</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    {</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> idim = 0; idim &lt; ndim; idim++)</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;            cout &lt;&lt; pp[inode][idim] &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span>;</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;        cout &lt;&lt; endl;</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    }</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    </div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; nnode; i++)</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    {</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;        nodes.push_back(pp[i]);</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;        super.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[i] = i;</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    }</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> inode = 0; inode &lt; nnode; inode++)</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;        super.<a class="code" href="classTet.html#a2769d89245abb8ebd79f5ae84586add8">surr</a>[inode] = -1;</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    compute_jacobian(super);</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    <span class="keywordflow">if</span>(super.<a class="code" href="classTet.html#ac1cbe6993c0a0804272c5faabc65bc0c">D</a> &lt; ZERO_TOL) cout &lt;&lt; <span class="stringliteral">&quot;Delaunay3d: !!Error: super triangle has negative Jacobian!&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    <span class="comment">//compute_circumsphere_contra(super);</span></div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    compute_circumsphere(super);</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;    elems.push_back(super);         <span class="comment">// add super to elems list</span></div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    <span class="comment">// set up initial face list</span></div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    <span class="comment">//cout &lt;&lt; &quot;Delaunay3d: set up initial face list\n&quot;;</span></div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;    <a class="code" href="structFace.html">Face</a> f[ndim+1];</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    f[0].<a class="code" href="structFace.html#a6bf70d054e14f8ee8468b86055f9dadc">p</a>[0] = super.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[1]; f[0].<a class="code" href="structFace.html#a6bf70d054e14f8ee8468b86055f9dadc">p</a>[1] = super.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[0]; f[0].<a class="code" href="structFace.html#a6bf70d054e14f8ee8468b86055f9dadc">p</a>[2] = super.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[2];</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    f[1].<a class="code" href="structFace.html#a6bf70d054e14f8ee8468b86055f9dadc">p</a>[0] = super.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[2]; f[1].<a class="code" href="structFace.html#a6bf70d054e14f8ee8468b86055f9dadc">p</a>[1] = super.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[0]; f[1].<a class="code" href="structFace.html#a6bf70d054e14f8ee8468b86055f9dadc">p</a>[2] = super.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[3];</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    f[2].<a class="code" href="structFace.html#a6bf70d054e14f8ee8468b86055f9dadc">p</a>[0] = super.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[3]; f[2].<a class="code" href="structFace.html#a6bf70d054e14f8ee8468b86055f9dadc">p</a>[1] = super.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[1]; f[2].<a class="code" href="structFace.html#a6bf70d054e14f8ee8468b86055f9dadc">p</a>[2] = super.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[2];</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    f[3].<a class="code" href="structFace.html#a6bf70d054e14f8ee8468b86055f9dadc">p</a>[0] = super.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[3]; f[3].<a class="code" href="structFace.html#a6bf70d054e14f8ee8468b86055f9dadc">p</a>[1] = super.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[0]; f[3].<a class="code" href="structFace.html#a6bf70d054e14f8ee8468b86055f9dadc">p</a>[2] = super.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[1];</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; nnode; i++)</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    {</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;        f[i].<a class="code" href="structFace.html#accd8f2dbe3de7e28386f1b850e88dd66">elem</a>[0] = 0;</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;        f[i].<a class="code" href="structFace.html#accd8f2dbe3de7e28386f1b850e88dd66">elem</a>[1] = -1;</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;        faces.push_back(f[i]);</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    }</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;    <span class="keywordtype">int</span> newpoinnum, contelem;</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;    vector&lt;double&gt; newpoin(ndim);</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    zero_scale = 1e5;</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    <span class="comment">// iterate through points</span></div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;Delaunay3d: Starting iteration over points\n&quot;</span>;</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ipoin = 0; ipoin &lt; npoints; ipoin++)</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    {</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;        <span class="comment">//cout &lt;&lt; &quot;New point : &quot; &lt;&lt; ipoin  &lt;&lt; &quot;  &quot; &lt;&lt; points.get(ipoin,0) &lt;&lt; &quot; &quot; &lt;&lt; points.get(ipoin,1) &lt;&lt; &quot; &quot; &lt;&lt; points.get(ipoin,2) &lt;&lt; endl;</span></div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> idim = 0; idim &lt; ndim; idim++)</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;            newpoin[idim] = points.get(ipoin,idim);</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;        nodes.push_back(newpoin);</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;        newpoinnum = nodes.size()-1;</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;        contelem = find_containing_tet(newpoin,elems.size()-1);</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;        <span class="keywordtype">int</span> curelem;</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;        vector&lt;int&gt; stk;                    <span class="comment">// stack to hold the indices of tets to be checked</span></div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;        <span class="keywordtype">double</span> dist;                        <span class="comment">// square of distance from point to circumcentre</span></div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;        stk.push_back(contelem);            <span class="comment">// add the containing element to the list of bad elements</span></div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;        vector&lt;int&gt; flags(elems.size(),0);  <span class="comment">// stores 1 at an index if the corresponding element has been checked for the Delaunay criterion</span></div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;        <span class="comment">//cout &lt;&lt; &quot;No. of elements = &quot; &lt;&lt; elems.size() &lt;&lt; endl;</span></div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;        </div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;        <span class="keywordflow">while</span>(stk.empty() == <span class="keyword">false</span>)</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;        {</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;            curelem = stk.back();           <span class="comment">// access last element in stack of elements to be checked</span></div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;            <span class="comment">// if this element has already been checked, just remove it and continue</span></div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;            <span class="keywordflow">if</span>(flags[curelem] == 1)</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;            {</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;                stk.pop_back();</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;            }</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;            </div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;            <span class="comment">//cout &lt;&lt; &quot;&gt;&quot; &lt;&lt; curelem &lt;&lt; &quot; &quot; &lt;&lt; flush;</span></div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;            flags[curelem] = 1;             <span class="comment">// curelem will now be checked</span></div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;            <span class="comment">// calculate square of distance between circumcentre and the point</span></div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;            dist = 0;</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> idim = 0; idim &lt; ndim; idim++)</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;                <span class="comment">//dist += (newpoin.at(idim) - elems.at(curelem).centre[idim]) * (newpoin.at(idim) - elems.at(curelem).centre[idim]);</span></div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;                dist += (newpoin[idim]-elems[curelem].centre[idim]) * (newpoin[idim]-elems[curelem].centre[idim]);</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;            <span class="comment">//dist = sqrt(dist);</span></div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;<span class="preprocessor">            #if DEBUGBW==1</span></div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;<span class="preprocessor"></span>            <span class="comment">//if(dabs(dist - elems[curelem].radius) &lt; ZERO_TOL) cout &lt;&lt; &quot;Delaunay3D: Degenerate case (type 2)!!\n&quot;;</span></div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;<span class="preprocessor">            #endif</span></div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;<span class="preprocessor"></span>            </div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;            <span class="comment">//cout &lt;&lt; &quot;Delaunay3d: bowyer_watson(): Dist^2 and radius^2 are &quot; &lt;&lt; dist &lt;&lt; &quot;, &quot; &lt;&lt; elems[curelem].radius &lt;&lt; endl;</span></div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;            <span class="keywordflow">if</span>(dist &lt; elems[curelem].radius - zero_scale*ZERO_TOL)      <span class="comment">// if point lies inside circumsphere, ie, Delaunay criterion is violated</span></div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;            {</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;                badelems.push_back(curelem);</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;                stk.pop_back();</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j = 0; j &lt; ndim+1; j++)</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;                    <span class="keywordflow">if</span>(elems[curelem].surr[j] &gt;= 0 &amp;&amp; flags[elems[curelem].surr[j]] == 0)       <span class="comment">// add surrounding elements (only which are not checked) to &quot;to be checked&quot; stack</span></div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;                        stk.push_back(elems[curelem].surr[j]);</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;            }</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;            {</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;                stk.pop_back();</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;            }</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;        }</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;        <span class="comment">//cout &lt;&lt; endl;</span></div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;        <span class="comment">// Output badelems for debug purpose</span></div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;        <span class="comment">/*cout &lt;&lt; &quot;Delaunay3d:  Badelems: &quot;;</span></div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;<span class="comment">        for(int i = 0; i &lt; badelems.size(); i++)</span></div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;<span class="comment">            cout &lt;&lt; badelems[i] &lt;&lt; &quot; &quot;;</span></div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;<span class="comment">        cout &lt;&lt; endl;*/</span></div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;        flags.assign(faces.size(),-1);</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;        <span class="comment">//cout &lt;&lt; &quot;** Flags : (&quot; &lt;&lt; faces.size() &lt;&lt; &quot;, &quot; &lt;&lt; flags.size() &lt;&lt; &quot;)\n&quot;;</span></div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ifa = 0; ifa &lt; faces.size(); ifa++)</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;        {</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> itri = 0; itri &lt; badelems.size(); itri++)</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;            {</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;                <span class="keywordflow">if</span>(faces[ifa].elem[0] == badelems[itri])        <span class="comment">//this face belongs to at least one bad element</span></div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;                {</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;                    <span class="keywordflow">if</span>(flags[ifa] != 1)                         <span class="comment">// this face does not belong to two bad elements</span></div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;                        flags[ifa] = 0;</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;                    <span class="keywordflow">else</span>                                        <span class="comment">// this face belongs to two bad elements</span></div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;                        flags[ifa] = -10;</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;                }</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(faces[ifa].elem[1] == badelems[itri])   <span class="comment">// this face belongs to at least one bad element</span></div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;                {</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;                    <span class="keywordflow">if</span>(flags[ifa] != 0)                         <span class="comment">// this face is NOT shared by two bad elements</span></div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;                        flags[ifa] = 1;</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;                    <span class="keywordflow">else</span>                                        <span class="comment">// this face is shared by two bad elements</span></div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;                        flags[ifa] = -10;</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;                }</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;            }</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;            <span class="keywordflow">if</span>(flags[ifa] == 0)</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;            {</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;                faces[ifa].elem[0] = -2;        <span class="comment">// -2 will be replaced by the index of a newly-formed element later</span></div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;                voidpoly.push_back(ifa);</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;            }</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;            <span class="keywordflow">if</span>(flags[ifa] == 1)</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;            {</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;                faces[ifa].elem[1] = -2;</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;                voidpoly.push_back(ifa);</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;            }</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;        }</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;        </div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ifa = 0; ifa &lt; faces.size(); ifa++)</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;        {</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;            <span class="keywordflow">if</span>(flags[ifa] == -10)               <span class="comment">// if face belongs to two bad elements, delete face</span></div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;            {</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;                faces.erase(faces.begin()+ifa);</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;                flags.erase(flags.begin()+ifa);</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;                <span class="comment">// now adjust voidpoly for the deleted face</span></div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; voidpoly.size(); i++)</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;                {</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;                    <span class="keywordflow">if</span>(voidpoly[i] &gt; ifa) voidpoly[i]--;</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;                }</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;                ifa--;</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;            }</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;        }</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;        <span class="comment">//cout &lt;&lt; &quot;Delaunay2D:  Fourth, delete bad elements\n&quot;;</span></div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ibe = 0; ibe &lt; badelems.size(); ibe++)</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;        {</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;            elems.erase(elems.begin()+badelems[ibe]);</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;            <span class="comment">//scan badelems for elements with indices greater than the one just deleted</span></div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = ibe+1; i &lt; badelems.size(); i++)</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;                <span class="keywordflow">if</span>(badelems[i] &gt; badelems[ibe]) badelems[i]--;</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;            <span class="comment">//scan surrounding elements in elems -- probably not efficient</span></div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; elems.size(); i++)</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;            {</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j = 0; j &lt; ndim+1; j++)</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;                {</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;                    <span class="keywordflow">if</span>(elems[i].surr[j] == badelems[ibe]) elems[i].surr[j] = -3;</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;                    <span class="keywordflow">if</span>(elems[i].surr[j] &gt; badelems[ibe]) elems[i].surr[j]--;</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;                }</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;            }</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;            <span class="comment">// adjust face data as well</span></div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; faces.size(); i++)</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;            {</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;                <span class="keywordflow">if</span>(faces[i].elem[0] &gt; badelems[ibe]) faces[i].elem[0]--;</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;                <span class="keywordflow">if</span>(faces[i].elem[1] &gt; badelems[ibe]) faces[i].elem[1]--;</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;            }</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;        }</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;        <span class="comment">// output voidpoly for debug purposes</span></div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;        <span class="comment">/*cout &lt;&lt; &quot;Delaunay3d:  voidpoly:&quot;;</span></div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;<span class="comment">        for(int i = 0; i &lt; voidpoly.size(); i++)</span></div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;<span class="comment">            cout &lt;&lt; &quot; &quot; &lt;&lt; voidpoly[i];</span></div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;<span class="comment">        cout &lt;&lt; endl;*/</span></div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;        <span class="comment">//cout &lt;&lt; &quot;Delaunay2D:  Fifth, add new elements; Also correspondingly update &#39;faces&#39;\n&quot;;</span></div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;        vector&lt;int&gt; newfaces;               <span class="comment">// new faces formed from new elements created</span></div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;        <span class="keywordtype">int</span> temp;</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ifa = 0; ifa &lt; voidpoly.size(); ifa++)      <span class="comment">// for each face in void polygon</span></div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;        {</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;            <a class="code" href="classTet.html">Tet</a> nw;</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;            nw.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[0] = newpoinnum;</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;            <span class="keywordflow">if</span>(faces[voidpoly[ifa]].elem[0] == -2)  </div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;            {   </div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;                <span class="comment">// if the new element is to the left of this face, the orientation of the remaining points of the tet is same as the orientation of the face</span></div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;                nw.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[1] = faces[voidpoly[ifa]].p[0];</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;                nw.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[2] = faces[voidpoly[ifa]].p[1];</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;                nw.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[3] = faces[voidpoly[ifa]].p[2];</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;                </div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;                <span class="comment">// we also need to reverse the face&#39;s orientation to make it point to the new element</span></div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;                temp = faces[voidpoly[ifa]].elem[1];</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;                faces[voidpoly[ifa]].elem[1] = elems.size();        <span class="comment">// this new element has not been pushed into elems yet, so we need elems.size() - 1 + 1</span></div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;                faces[voidpoly[ifa]].elem[0] = temp;</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;                faces[voidpoly[ifa]].p[0] = nw.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[1];</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;                faces[voidpoly[ifa]].p[1] = nw.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[3];</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;                faces[voidpoly[ifa]].p[2] = nw.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[2];</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;            }</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span>(faces[voidpoly[ifa]].elem[1] == -2) <span class="comment">// if the new element is to the right of the face</span></div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;            {</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;                nw.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[1] = faces[voidpoly[ifa]].p[1];</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;                nw.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[2] = faces[voidpoly[ifa]].p[0];</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;                nw.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[3] = faces[voidpoly[ifa]].p[2];</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;                faces[voidpoly[ifa]].elem[1] = elems.size();</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;            }</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;            <span class="keywordflow">else</span> cout &lt;&lt; <span class="stringliteral">&quot;Delaunay2D: !! Error while creating new element - face &quot;</span> &lt;&lt; voidpoly[ifa] &lt;&lt; <span class="stringliteral">&quot; in voidpoly does not have -2 as either left elem or right elem.\n&quot;</span>;</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;            <span class="comment">// After the above, the right element of the current void face has the new element.</span></div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;            compute_jacobian(nw);</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;            </div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;            <span class="comment">//compute_circumsphere_contra(nw);</span></div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;            compute_circumsphere(nw);</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;            <span class="comment">//cout &lt;&lt; &quot;Delaunay3d: bowyer_watson(): New element jacobian and radius^2 : &quot; &lt;&lt; nw.D &lt;&lt; &quot; &quot; &lt;&lt; nw.radius &lt;&lt; endl;</span></div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;            <span class="keywordflow">if</span>(nw.<a class="code" href="classTet.html#ac1cbe6993c0a0804272c5faabc65bc0c">D</a> &lt; ZERO_TOL)</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;            {</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;                cout &lt;&lt; <span class="stringliteral">&quot;Delaunay3d: bowyer_watson(): New elem is degenerate or inverted! Points are &quot;</span> &lt;&lt; nw.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[0] &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; nw.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[1] &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; nw.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[2] &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; nw.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[3] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; nw.<a class="code" href="classTet.html#ac1cbe6993c0a0804272c5faabc65bc0c">D</a> &lt;&lt; endl;</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;                <span class="comment">//elems.push_back(nw);</span></div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;                <span class="comment">//return;</span></div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;            }</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; nnode; i++)</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;                nw.<a class="code" href="classTet.html#a2769d89245abb8ebd79f5ae84586add8">surr</a>[i] = -5;</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;            <span class="comment">// Push new element into the elements&#39; list</span></div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;            elems.push_back(nw);</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;            vector&lt;bool&gt; val(ndim+1, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;            <span class="comment">//^ flag for each face of the new element - but we actually only need it for those faces that include the new point 0, ie faces 1, 2 and 3.</span></div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;            <span class="comment">//^ val[i] contains true if a newface corresponding to the ith local face of nw has been found.</span></div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;            <span class="keywordtype">int</span> localface, jface;</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> jfa = 0; jfa &lt; newfaces.size(); jfa++)</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;            {</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;                <span class="comment">// test whether the newface is part of the new tet.</span></div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;                localface = check_face_tet(nw, faces[newfaces[jfa]]);</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;                </div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;                <span class="comment">// If this newface does not match any face of the new element, go to the next newface.</span></div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;                <span class="keywordflow">if</span>(localface == -1) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;                <span class="comment">// Face formed by new point and p[1]</span></div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(localface==0) {</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;                    cout &lt;&lt; <span class="stringliteral">&quot;Delaunay3d: bowyer_watson(): ! Error: A member of newfaces is not actually a new face!!&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;                }</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;                <span class="comment">// if this newface has -4 as the right element, then replace this by the new element</span></div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;                </div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;                faces[newfaces[jfa]].elem[1] = elems.size()-1;</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;                elems.back().surr[localface] = faces[newfaces[jfa]].elem[0];</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;                <span class="comment">// Also, find which local face of newfaces[jfa]&#39;s left element is the same as newfaces[jfa].</span></div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;                <span class="comment">// Set the new element as a surrounding element of the left element of newfaces[jfa].</span></div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;                jface = check_face_tet(elems[faces[newfaces[jfa]].elem[0]], faces[newfaces[jfa]]);</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;                <span class="keywordflow">if</span>(jface == -1) { cout &lt;&lt; <span class="stringliteral">&quot;Delaunay3d: bowyer_watson(): ! Error while setting surrounding element of a new element!&quot;</span> &lt;&lt; endl; }</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;                elems[faces[newfaces[jfa]].elem[0]].surr[jface] = elems.size()-1;</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;                val[localface] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;                </div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;                <span class="comment">// if faces corresponding to all 3 new faces of the new element have been found, quit the jfa loop</span></div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;                <span class="comment">/*bool brk = true;</span></div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;<span class="comment">                for(int i = 1; i &lt; ndim+1; i++)</span></div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;<span class="comment">                    if(!val[i]) brk = false;</span></div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;<span class="comment">                if(brk) break;*/</span></div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;            }</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;            <a class="code" href="structFace.html">Face</a> fc;</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iface = 1; iface &lt; ndim+1; iface++)</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;            {</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;                <span class="comment">// if face corresponding to local node iface does not exist in newfaces, add the face.</span></div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;                <span class="keywordflow">if</span>(val[iface] == <span class="keyword">false</span>)</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;                {</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;                    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j = 0; j &lt; nnode-1; j++)    </div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;                        fc.<a class="code" href="structFace.html#a6bf70d054e14f8ee8468b86055f9dadc">p</a>[j] = nw.<a class="code" href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">p</a>[lpofa.get(iface,j)];</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;                    fc.<a class="code" href="structFace.html#accd8f2dbe3de7e28386f1b850e88dd66">elem</a>[0] = elems.size()-1;</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;                    fc.<a class="code" href="structFace.html#accd8f2dbe3de7e28386f1b850e88dd66">elem</a>[1] = -4;            <span class="comment">// the element to the right of the new face is undefined as of now.</span></div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;                    </div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;                    <span class="comment">// Add this new face to list of faces and the current list of newfaces.</span></div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;                    faces.push_back(fc);</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;                    newfaces.push_back(faces.size()-1);</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;                }</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;            }</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;            <span class="comment">// Surrounding element of this new element - across pre-existing face</span></div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;            elems.back().surr[0] = (faces[voidpoly[ifa]].elem[0] == elems.size()-1) ? faces[voidpoly[ifa]].elem[1] : faces[voidpoly[ifa]].elem[0];</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;            <span class="comment">//elems.back().surr[0] = faces[voidpoly[ifa]].elem[0];</span></div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;            <span class="comment">// Now to set the new element as a surrounding element of the element neighboring this void face</span></div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;            <span class="keywordtype">int</span> nbor = elems.back().<a class="code" href="classTet.html#a2769d89245abb8ebd79f5ae84586add8">surr</a>[0];</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;            </div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;            <span class="keywordflow">if</span>(nbor &gt;= 0)</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;            {</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;                localface = check_face_tet(elems[nbor], faces[voidpoly[ifa]]);</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;                <span class="keywordflow">if</span>(localface &lt; 0) cout &lt;&lt; <span class="stringliteral">&quot;Delaunay3d: bowyer_watson(): ! Error in locating void face on pre-existing element!&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;                elems[nbor].surr[localface] = elems.size()-1;</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;            }</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;        }</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;        <span class="comment">//cout &lt;&lt; &quot;Delaunay2D:  Added point &quot; &lt;&lt; ipoin &lt;&lt; &quot;.\n&quot;;</span></div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;        <span class="comment">//empty badelems and voidpoly</span></div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;        badelems.clear();</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;        voidpoly.clear();</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;    } </div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;    </div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;    <span class="comment">// end iteration over points</span></div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;    </div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;Delaunay3d: bowyer_watson(): Number of elements before removing super points is &quot;</span> &lt;&lt; elems.size() &lt;&lt; endl;</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;    <span class="comment">// Remove super triangle</span></div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;    <span class="comment">//cout &lt;&lt; &quot;Delaunay2D:  Remove super triangle\n&quot;;</span></div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ielem = 0; ielem &lt; elems.size(); ielem++)</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;    {</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;        <span class="comment">//vector&lt;bool&gt; val(nnode,false);</span></div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;        <span class="keywordtype">bool</span> finval = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; nnode; i++)</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;        {</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;            <span class="keywordflow">if</span>(elems[ielem].p[i] == 0 || elems[ielem].p[i] == 1 || elems[ielem].p[i] == 2 || elems[ielem].p[i] == 3) {</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;                finval = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;            }</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;        }</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;        <span class="comment">// if finval is true, it means ielem contains one of the first 4 nodes</span></div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;        <span class="keywordflow">if</span>(finval)</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;        {</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;            elems.erase(elems.begin()+ielem);</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;            <span class="comment">// re-adjust surr[] of each element. This is yet another place where we would benefit from a graph data structure.</span></div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iel = 0; iel &lt; elems.size(); iel++)</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;            {</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j = 0; j &lt; nnode; j++)</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;                {</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;                    <span class="keywordflow">if</span>(elems[iel].surr[j] == ielem) elems[iel].surr[j] = -1;</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;                    <span class="keywordflow">if</span>(elems[iel].surr[j] &gt; ielem) elems[iel].surr[j]--;</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;                }</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;            }</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;            ielem--;</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;        }</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;    }</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;    </div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;    <span class="comment">// remove super nodes</span></div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;    nodes.erase(nodes.begin(),nodes.begin()+nnode);</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;    </div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ielem = 0; ielem &lt; elems.size(); ielem++)</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;    {</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; nnode; i++)</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;        {</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;            elems[ielem].p[i] = elems[ielem].p[i]-nnode;</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;        }</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;    }</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;    <span class="comment">// remove super faces - not needed</span></div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;Delaunay3d: Triangulation done.\n&quot;</span>;</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;    <span class="comment">// re-scale points</span></div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ip = 0; ip &lt; nodes.size(); ip++)</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> idim = 0; idim &lt; ndim; idim++)</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;            nodes[ip][idim] *= scalef[idim];</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;}</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;</div>
<div class="line"><a name="l01127"></a><span class="lineno"><a class="line" href="classDelaunay3d.html#a9ae73ad17b71066c3c6d2dfd94cf9921"> 1127</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classDelaunay3d.html#a9ae73ad17b71066c3c6d2dfd94cf9921">Delaunay3d::clear</a>()                    <span class="comment">// reset the Delaunay2D object, except for input data</span></div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;{</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;    nodes.clear();</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;    elems.clear();</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;    faces.clear();</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;    badelems.clear();</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;    voidpoly.clear();</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;}</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;</div>
<div class="line"><a name="l01136"></a><span class="lineno"><a class="line" href="classDelaunay3d.html#a1b2b5c473458c4dcfb0a557536e3200b"> 1136</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classDelaunay3d.html#a1b2b5c473458c4dcfb0a557536e3200b">Delaunay3d::writeGmsh2</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> mfile)<span class="keyword"> const</span></div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;    ofstream outf(mfile);</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;    outf &lt;&lt; <span class="stringliteral">&quot;$MeshFormat\n2.2 0 8\n$EndMeshFormat\n&quot;</span>;</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;    outf &lt;&lt; <span class="stringliteral">&quot;$Nodes\n&quot;</span> &lt;&lt; nodes.size() &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ip = 0; ip &lt; nodes.size(); ip++)</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;    {</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;        outf &lt;&lt; ip+1 &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; nodes[ip][0] &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; nodes[ip][1] &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; nodes[ip][2] &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;    }</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;    outf &lt;&lt; <span class="stringliteral">&quot;$Elements\n&quot;</span> &lt;&lt; elems.size() &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iel = 0; iel &lt; elems.size(); iel++)</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;    {</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;        outf &lt;&lt; iel+1 &lt;&lt; <span class="stringliteral">&quot; 4 2 0 2&quot;</span>;</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; nnode; i++)</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;            outf &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; elems[iel].p[i]+1;</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;        outf &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;    }</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;    outf &lt;&lt; <span class="stringliteral">&quot;$EndElements\n&quot;</span>;</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;    outf.close();</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;}</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;</div>
<div class="line"><a name="l01159"></a><span class="lineno"><a class="line" href="classDelaunay3d.html#a87d4e74a20d898809cff8858264e131a"> 1159</a></span>&#160;<a class="code" href="structWalkdata.html">Walkdata</a> <a class="code" href="classDelaunay3d.html#a87d4e74a20d898809cff8858264e131a">Delaunay3d::find_containing_tet_and_barycentric_coords</a>(<span class="keyword">const</span> vector&lt;double&gt;&amp; xx, <span class="keyword">const</span> <span class="keywordtype">int</span> startelement) <span class="keyword">const</span></div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;<span class="comment">/* Note that the local node numbering is not assumed to be consistent. So checking the sign of the area of the triangle formed by the new point and an edge is not enough.</span></div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;<span class="comment">   Rather, we compare the corresponding area-ratio. If the sign of the area of the triangle created by the new point changes because of opposite orientation, so does the area of the triangle being checked. */</span></div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;{</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;    <a class="code" href="structWalkdata.html">Walkdata</a> dat;</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;    <span class="keywordflow">if</span>(xx.size() &lt; 3) {</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;Delaunau3D: find_containing_triangle(): ! Input vector is not long enough!\n&quot;</span>;</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;        <span class="keywordflow">return</span> dat;</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;    }</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;    <span class="keywordtype">int</span> ielem = startelement;</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;    <a class="code" href="classTet.html">Tet</a> super;</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;    vector&lt;double&gt; l(ndim+1);</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;    <span class="keywordtype">bool</span> found;</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;Delaunay3D:   Finding containing tet...&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;    </div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;    <span class="keywordflow">while</span>(1)</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;    {</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;        found = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;        <span class="keywordflow">if</span>(ielem &lt; 0 || ielem &gt;= elems.size()) { cout &lt;&lt; <span class="stringliteral">&quot;Delaunay3d:   !! Reached an element index that is out of bounds!! Index is &quot;</span> &lt;&lt; ielem &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>; }</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;        super = elems[ielem];</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> inode = 0; inode &lt; nnode; inode++)</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;        {</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;            <span class="comment">// get jacobian</span></div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;            l[inode] = det4(ielem,inode,xx);</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;<span class="preprocessor">            #if DEBUGBW==1</span></div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;<span class="preprocessor"></span>            <span class="keywordflow">if</span>(dabs(l[inode]) &lt; ZERO_TOL) cout &lt;&lt; <span class="stringliteral">&quot;Delaunay3D: find_containing_tet(): ! Degenerate case (type 1) for l &quot;</span> &lt;&lt; inode &lt;&lt; <span class="stringliteral">&quot;!!\n&quot;</span>;</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;<span class="preprocessor">            #endif</span></div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;<span class="preprocessor"></span>            <span class="keywordflow">if</span>(l[inode]/super.<a class="code" href="classTet.html#ac1cbe6993c0a0804272c5faabc65bc0c">D</a> &lt; 0)</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;            {</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;                ielem = super.<a class="code" href="classTet.html#a2769d89245abb8ebd79f5ae84586add8">surr</a>[inode];</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;                found = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;            }</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;        }</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;        <span class="comment">// if all 4 area-ratios are positive, we&#39;ve found our element</span></div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;        <span class="keywordflow">if</span>(found) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;    }</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;    <span class="comment">//cout &lt;&lt; &quot;Delaunay2D:   Containing triangle found: &quot; &lt;&lt; ielem &lt;&lt; &quot;.\n&quot;;</span></div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;    dat.elem = ielem; </div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> inode = 0; inode &lt; nnode; inode++)</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;        dat.areacoords[inode] = l[inode]/super.<a class="code" href="classTet.html#ac1cbe6993c0a0804272c5faabc65bc0c">D</a>;</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;    <span class="keywordflow">return</span> dat;</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;}</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;</div>
<div class="line"><a name="l01206"></a><span class="lineno"><a class="line" href="classDelaunay3d.html#a4751319429c34ae060834a9942b28f5e"> 1206</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classDelaunay3d.html#a4751319429c34ae060834a9942b28f5e">Delaunay3d::compute_jacobians</a>()</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;{</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;    <span class="comment">//cout &lt;&lt; &quot;Delaunay3D: Jacobians: &quot;;</span></div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;    jacobians.setup(elems.size(),1);</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;    vector&lt;double&gt; a(ndim), b(ndim), c(ndim), base(ndim);</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;    <span class="keywordtype">double</span> val;</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; elems.size(); i++)</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;    {</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;        <span class="comment">//jacobians(i) = elems[i].D;</span></div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> idim = 0; idim &lt; ndim; idim++)</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;        {</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;            a[idim] = nodes[elems[i].p[1]][idim] - nodes[elems[i].p[0]][idim];</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;            b[idim] = nodes[elems[i].p[2]][idim] - nodes[elems[i].p[0]][idim];</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;            c[idim] = nodes[elems[i].p[3]][idim] - nodes[elems[i].p[0]][idim];</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;        }</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;        cross_product3(base, a, b);</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;        val = dot(base,c);</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;        jacobians(i) = val;</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;    }</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;}</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;<span class="keywordtype">void</span> Delaunay3d::write_jacobians(<span class="keyword">const</span> <span class="keywordtype">string</span> fname)<span class="keyword"> const</span></div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;    ofstream fout(fname);</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; elems.size(); i++)</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;        fout &lt;&lt; jacobians.get(i) &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; elems[i].D &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;    fout.close();</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;}</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;<span class="keywordtype">bool</span> Delaunay3d::detect_negative_jacobians()<span class="keyword"> const</span></div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;Delaunay3D: Looking for invalid elements...\n&quot;</span>;</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;    <span class="keywordtype">bool</span> flagj = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;    <span class="keywordtype">int</span> numneg = 0;</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; elems.size(); i++)</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;    {</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;        <span class="keywordflow">if</span>(jacobians.get(i) &lt; 0.0+ZERO_TOL) {</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;            cout &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; jacobians.get(i) &lt;&lt; endl;</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;            flagj = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;            numneg++;</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;        }</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;    }</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;    <span class="keywordflow">if</span>(flagj == <span class="keyword">true</span>) cout &lt;&lt; <span class="stringliteral">&quot;Delaunay3D: detect_negative_jacobians(): There exist &quot;</span> &lt;&lt; numneg &lt;&lt; <span class="stringliteral">&quot; element(s) with negative jacobian!!&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;    <span class="keywordflow">return</span> flagj;</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;}</div>
<div class="ttc" id="classDelaunay3d_html_a4f7e267a3743c5c48bde1bc9f85064ba"><div class="ttname"><a href="classDelaunay3d.html#a4f7e267a3743c5c48bde1bc9f85064ba">Delaunay3d::faces</a></div><div class="ttdeci">PList&lt; Face &gt; faces</div><div class="ttdoc">List of all faces in the Delaunay graph. </div><div class="ttdef"><b>Definition:</b> abbowyerwatson3d2.hpp:123</div></div>
<div class="ttc" id="classDelaunay3d_html_a82f9c728e3ba3de9eb234dee65ae3b16"><div class="ttname"><a href="classDelaunay3d.html#a82f9c728e3ba3de9eb234dee65ae3b16">Delaunay3d::find_containing_tet</a></div><div class="ttdeci">int find_containing_tet(const vector&lt; double &gt; &amp;r, const int startelement) const </div><div class="ttdoc">Locates the Delaunay graph (DG) element which contains the input point (improved). </div><div class="ttdef"><b>Definition:</b> abbowyerwatson3d2.hpp:549</div></div>
<div class="ttc" id="classDelaunay3d_html_ab9e7887ccfacfa787f73c16650c1b7c6"><div class="ttname"><a href="classDelaunay3d.html#ab9e7887ccfacfa787f73c16650c1b7c6">Delaunay3d::det4</a></div><div class="ttdeci">double det4(const int ielem, const int i, const vector&lt; double &gt; &amp;r) const </div><div class="ttdoc">Computes the jacobian of a tet formed from a point and a face of a tetrahedron. </div><div class="ttdef"><b>Definition:</b> abbowyerwatson3d2.hpp:475</div></div>
<div class="ttc" id="classDelaunay3d_html_a9ae73ad17b71066c3c6d2dfd94cf9921"><div class="ttname"><a href="classDelaunay3d.html#a9ae73ad17b71066c3c6d2dfd94cf9921">Delaunay3d::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdoc">Reset the Delaunay3d object, except for input data. </div><div class="ttdef"><b>Definition:</b> abbowyerwatson3d2.hpp:1127</div></div>
<div class="ttc" id="classTet_html_a96866fe360098dd0814fc1f0986991c2"><div class="ttname"><a href="classTet.html#a96866fe360098dd0814fc1f0986991c2">Tet::centre</a></div><div class="ttdeci">Point centre</div><div class="ttdoc">Coords of circumcenter of the tet. </div><div class="ttdef"><b>Definition:</b> abbowyerwatson3d2.hpp:69</div></div>
<div class="ttc" id="structFace_html"><div class="ttname"><a href="structFace.html">Face</a></div><div class="ttdoc">Structure for triangular face. </div><div class="ttdef"><b>Definition:</b> abbowyerwatson3d2.hpp:57</div></div>
<div class="ttc" id="classDelaunay3d_html_aab9796c1c3cf7aafb89fdcb407695923"><div class="ttname"><a href="classDelaunay3d.html#aab9796c1c3cf7aafb89fdcb407695923">Delaunay3d::check_face_tet</a></div><div class="ttdeci">int check_face_tet(const Tet &amp;elem, const Face &amp;face) const </div><div class="ttdoc">Returns the local face number (number of node opposite to the face) of elem&amp;#39;s face that is the same a...</div><div class="ttdef"><b>Definition:</b> abbowyerwatson3d2.hpp:595</div></div>
<div class="ttc" id="structFace_html_accd8f2dbe3de7e28386f1b850e88dd66"><div class="ttname"><a href="structFace.html#accd8f2dbe3de7e28386f1b850e88dd66">Face::elem</a></div><div class="ttdeci">int elem[2]</div><div class="ttdoc">elements on either side of the face </div><div class="ttdef"><b>Definition:</b> abbowyerwatson3d2.hpp:60</div></div>
<div class="ttc" id="classPoint_html"><div class="ttname"><a href="classPoint.html">Point</a></div><div class="ttdef"><b>Definition:</b> apoint.hpp:13</div></div>
<div class="ttc" id="classTet_html_aa4724678cfa4f4fbd0338bda425d885d"><div class="ttname"><a href="classTet.html#aa4724678cfa4f4fbd0338bda425d885d">Tet::p</a></div><div class="ttdeci">int p[4]</div><div class="ttdoc">Indices of vertices. </div><div class="ttdef"><b>Definition:</b> abbowyerwatson3d2.hpp:68</div></div>
<div class="ttc" id="classPList_html"><div class="ttname"><a href="classPList.html">PList&lt; Tet &gt;</a></div></div>
<div class="ttc" id="classDelaunay3d_html_a096cf0a463d63b968018a2c22f9f99cb"><div class="ttname"><a href="classDelaunay3d.html#a096cf0a463d63b968018a2c22f9f99cb">Delaunay3d::compute_jacobian</a></div><div class="ttdeci">void compute_jacobian(Tet &amp;elem)</div><div class="ttdoc">Computes 6*volume, ie the Jacobian of any tetrahedron. </div><div class="ttdef"><b>Definition:</b> abbowyerwatson3d2.hpp:286</div></div>
<div class="ttc" id="classDelaunay3d_html_a29fcc2ab4187bcdee2a9b0481cfee87b"><div class="ttname"><a href="classDelaunay3d.html#a29fcc2ab4187bcdee2a9b0481cfee87b">Delaunay3d::compute_circumsphere</a></div><div class="ttdeci">void compute_circumsphere(Tet &amp;elem)</div><div class="ttdoc">Computes circumcentre and circumradius of a tet. </div><div class="ttdef"><b>Definition:</b> abbowyerwatson3d2.hpp:320</div></div>
<div class="ttc" id="classDelaunay3d_html_a2c231a91c2ecf486f41c65ff7e6dd8c7"><div class="ttname"><a href="classDelaunay3d.html#a2c231a91c2ecf486f41c65ff7e6dd8c7">Delaunay3d::tetvol</a></div><div class="ttdeci">double tetvol(const vector&lt; double &gt; &amp;a, const vector&lt; double &gt; &amp;b, const vector&lt; double &gt; &amp;c, const vector&lt; double &gt; &amp;d) const </div><div class="ttdoc">Returs the Jacobian (6 * volume) of a tetrahedron formed by 4 points taken as arguments. </div><div class="ttdef"><b>Definition:</b> abbowyerwatson3d2.hpp:265</div></div>
<div class="ttc" id="classDelaunay3d_html_ab7b8a0611c2018eaf7c4ca1d2fe71504"><div class="ttname"><a href="classDelaunay3d.html#ab7b8a0611c2018eaf7c4ca1d2fe71504">Delaunay3d::badelems</a></div><div class="ttdeci">std::vector&lt; int &gt; badelems</div><div class="ttdoc">Collection of &amp;#39;bad elements&amp;#39;, that are to be removed while adding a point; its are integers that inde...</div><div class="ttdef"><b>Definition:</b> abbowyerwatson3d2.hpp:122</div></div>
<div class="ttc" id="classDelaunay3d_html_ac0102c73f3df68e39f54d7f321286c6e"><div class="ttname"><a href="classDelaunay3d.html#ac0102c73f3df68e39f54d7f321286c6e">Delaunay3d::find_containing_tet_old</a></div><div class="ttdeci">int find_containing_tet_old(const vector&lt; double &gt; &amp;r, const int startelement) const </div><div class="ttdoc">Locates the Delaunay graph (DG) element which contains the input point. </div><div class="ttdef"><b>Definition:</b> abbowyerwatson3d2.hpp:500</div></div>
<div class="ttc" id="classDelaunay3d_html_a611ff0f25e41d19b4a55a9240c8c92ee"><div class="ttname"><a href="classDelaunay3d.html#a611ff0f25e41d19b4a55a9240c8c92ee">Delaunay3d::elems</a></div><div class="ttdeci">PList&lt; Tet &gt; elems</div><div class="ttdoc">List of all elements in the Delaunay graph. </div><div class="ttdef"><b>Definition:</b> abbowyerwatson3d2.hpp:121</div></div>
<div class="ttc" id="amatrix2_8hpp_html"><div class="ttname"><a href="amatrix2_8hpp.html">amatrix2.hpp</a></div><div class="ttdoc">Defines a class to manipulate matrices. </div></div>
<div class="ttc" id="classDelaunay3d_html_af0c09e767b2fff2d909a80b37bb57ca4"><div class="ttname"><a href="classDelaunay3d.html#af0c09e767b2fff2d909a80b37bb57ca4">Delaunay3d::cross_product3</a></div><div class="ttdeci">void cross_product3(vector&lt; double &gt; &amp;c, const vector&lt; double &gt; &amp;a, const vector&lt; double &gt; &amp;b) const </div><div class="ttdoc">Computes cross product c of two 3-vectors a and b; c = a x b. </div><div class="ttdef"><b>Definition:</b> abbowyerwatson3d2.hpp:292</div></div>
<div class="ttc" id="classDelaunay3d_html_a136aede2d375d95773f5156ca3307a12"><div class="ttname"><a href="classDelaunay3d.html#a136aede2d375d95773f5156ca3307a12">Delaunay3d::lpofa</a></div><div class="ttdeci">Matrix&lt; int &gt; lpofa</div><div class="ttdoc">Stores the face-point relationship of a tetrahedron. </div><div class="ttdef"><b>Definition:</b> abbowyerwatson3d2.hpp:115</div></div>
<div class="ttc" id="classDelaunay3d_html_aecc133c027972c6093f625ec0e8242d2"><div class="ttname"><a href="classDelaunay3d.html#aecc133c027972c6093f625ec0e8242d2">Delaunay3d::voidpoly</a></div><div class="ttdeci">std::vector&lt; int &gt; voidpoly</div><div class="ttdoc">Collection of faces that bounds the void obtained after removing bad elements while adding a point; i...</div><div class="ttdef"><b>Definition:</b> abbowyerwatson3d2.hpp:124</div></div>
<div class="ttc" id="classTet_html_a7306f9a3f8047b993f846e2599e814ad"><div class="ttname"><a href="classTet.html#a7306f9a3f8047b993f846e2599e814ad">Tet::radius</a></div><div class="ttdeci">double radius</div><div class="ttdoc">Square of radius of circumcircle of tet. </div><div class="ttdef"><b>Definition:</b> abbowyerwatson3d2.hpp:72</div></div>
<div class="ttc" id="classamat_1_1Matrix_html"><div class="ttname"><a href="classamat_1_1Matrix.html">amat::Matrix&lt; int &gt;</a></div></div>
<div class="ttc" id="classDelaunay3d_html_aa12fca6f5f1fef721e11f5e87db8cd5f"><div class="ttname"><a href="classDelaunay3d.html#aa12fca6f5f1fef721e11f5e87db8cd5f">Delaunay3d::zero_scale</a></div><div class="ttdeci">double zero_scale</div><div class="ttdoc">Value used to provide tolerance for the Delaunay criterion. </div><div class="ttdef"><b>Definition:</b> abbowyerwatson3d2.hpp:111</div></div>
<div class="ttc" id="classDelaunay3d_html_a7bee4058767627eccd7b1e400ed69f92"><div class="ttname"><a href="classDelaunay3d.html#a7bee4058767627eccd7b1e400ed69f92">Delaunay3d::bowyer_watson</a></div><div class="ttdeci">void bowyer_watson()</div><div class="ttdoc">Computes the Delaunay triangulation (tetrahedralization, in this case). </div><div class="ttdef"><b>Definition:</b> abbowyerwatson3d2.hpp:648</div></div>
<div class="ttc" id="classDelaunay3d_html_a1da70ba1af9166f5ac574f6d3b19e9b1"><div class="ttname"><a href="classDelaunay3d.html#a1da70ba1af9166f5ac574f6d3b19e9b1">Delaunay3d::nodes</a></div><div class="ttdeci">std::vector&lt; Point &gt; nodes</div><div class="ttdoc">List of nodes in the Delaunay graph. </div><div class="ttdef"><b>Definition:</b> abbowyerwatson3d2.hpp:120</div></div>
<div class="ttc" id="classDelaunay3d_html_af87e9ce75e735e325bfde3c6df5b91a3"><div class="ttname"><a href="classDelaunay3d.html#af87e9ce75e735e325bfde3c6df5b91a3">Delaunay3d::dot</a></div><div class="ttdeci">double dot(const vector&lt; double &gt; &amp;a, const vector&lt; double &gt; &amp;b) const </div><div class="ttdoc">Returns the dot product of two vectors. </div><div class="ttdef"><b>Definition:</b> abbowyerwatson3d2.hpp:300</div></div>
<div class="ttc" id="classDelaunay3d_html_a9e5372b14b21c65de51388d2551d7f68"><div class="ttname"><a href="classDelaunay3d.html#a9e5372b14b21c65de51388d2551d7f68">Delaunay3d::l2norm</a></div><div class="ttdeci">double l2norm(const vector&lt; double &gt; &amp;a) const </div><div class="ttdoc">Returns the  norm of a vector. </div><div class="ttdef"><b>Definition:</b> abbowyerwatson3d2.hpp:309</div></div>
<div class="ttc" id="classTet_html_a2769d89245abb8ebd79f5ae84586add8"><div class="ttname"><a href="classTet.html#a2769d89245abb8ebd79f5ae84586add8">Tet::surr</a></div><div class="ttdeci">int surr[4]</div><div class="ttdoc">Indices of surrounding tets. Note that the neighbor corresponding to surr[3] is opposite the vertex p...</div><div class="ttdef"><b>Definition:</b> abbowyerwatson3d2.hpp:70</div></div>
<div class="ttc" id="structWalkdata_html"><div class="ttname"><a href="structWalkdata.html">Walkdata</a></div><div class="ttdoc">Intended to encapsulate data required by &amp;#39;walk-through&amp;#39; algorithms. </div><div class="ttdef"><b>Definition:</b> abbowyerwatson3d2.hpp:93</div></div>
<div class="ttc" id="classDelaunay3d_html_a1b2b5c473458c4dcfb0a557536e3200b"><div class="ttname"><a href="classDelaunay3d.html#a1b2b5c473458c4dcfb0a557536e3200b">Delaunay3d::writeGmsh2</a></div><div class="ttdeci">void writeGmsh2(const string mfile) const </div><div class="ttdoc">Writes the Delaunay graph to a Gmsh file. </div><div class="ttdef"><b>Definition:</b> abbowyerwatson3d2.hpp:1136</div></div>
<div class="ttc" id="classTet_html_ac1cbe6993c0a0804272c5faabc65bc0c"><div class="ttname"><a href="classTet.html#ac1cbe6993c0a0804272c5faabc65bc0c">Tet::D</a></div><div class="ttdeci">double D</div><div class="ttdoc">6*volume of tet. </div><div class="ttdef"><b>Definition:</b> abbowyerwatson3d2.hpp:71</div></div>
<div class="ttc" id="classDelaunay3d_html"><div class="ttname"><a href="classDelaunay3d.html">Delaunay3d</a></div><div class="ttdoc">Implements the &amp;quot;Delaunay kernel&amp;quot; for generating the tetrahedral Delaunay tessellation of the convex h...</div><div class="ttdef"><b>Definition:</b> abbowyerwatson3d2.hpp:100</div></div>
<div class="ttc" id="structFace_html_a6bf70d054e14f8ee8468b86055f9dadc"><div class="ttname"><a href="structFace.html#a6bf70d054e14f8ee8468b86055f9dadc">Face::p</a></div><div class="ttdeci">int p[3]</div><div class="ttdoc">indices of endpoints of the face </div><div class="ttdef"><b>Definition:</b> abbowyerwatson3d2.hpp:59</div></div>
<div class="ttc" id="classDelaunay3d_html_a87d4e74a20d898809cff8858264e131a"><div class="ttname"><a href="classDelaunay3d.html#a87d4e74a20d898809cff8858264e131a">Delaunay3d::find_containing_tet_and_barycentric_coords</a></div><div class="ttdeci">Walkdata find_containing_tet_and_barycentric_coords(const vector&lt; double &gt; &amp;rr, const int startelement) const </div><div class="ttdoc">Finds the DG element containing a given point. </div><div class="ttdef"><b>Definition:</b> abbowyerwatson3d2.hpp:1159</div></div>
<div class="ttc" id="classTet_html"><div class="ttname"><a href="classTet.html">Tet</a></div><div class="ttdoc">Class representing a tetrahedron. </div><div class="ttdef"><b>Definition:</b> abbowyerwatson3d2.hpp:65</div></div>
<div class="ttc" id="classDelaunay3d_html_a4751319429c34ae060834a9942b28f5e"><div class="ttname"><a href="classDelaunay3d.html#a4751319429c34ae060834a9942b28f5e">Delaunay3d::compute_jacobians</a></div><div class="ttdeci">void compute_jacobians()</div><div class="ttdoc">Computes the jacobian of all elements in the triangulation using cross products. </div><div class="ttdef"><b>Definition:</b> abbowyerwatson3d2.hpp:1206</div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
