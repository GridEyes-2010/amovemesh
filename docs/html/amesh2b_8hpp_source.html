<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>Amocurve: amesh2b.hpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Amocurve
   </div>
   <div id="projectbrief">A library for unstructured mesh movement and curved mesh generation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">amesh2b.hpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">// Data structure and setup for 2D unstructured triangular mesh.</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">// This reads Dr Luo&#39;s mesh file containing boundary point data rather than boundary face data.</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// Aditya Kashi</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">// Feb 5, 2015</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">// Feb 26, 2015: Adding mesh-movement function movemesh2d_bs().</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#ifndef _GLIBCXX_IOSTREAM</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#ifndef _GLIBCXX_FSTREAM</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#ifndef _GLIBCXX_STRING</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#ifndef _GLIBCXX_CMATH</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#ifdef _OPENMP</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#ifndef OMP_H</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#include &lt;omp.h&gt;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#define nthreads_mesh 8</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#define __AMESH2D_H</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#ifndef __AMATRIX2_H</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#include &quot;<a class="code" href="amatrix2_8hpp.html">amatrix2.hpp</a>&quot;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#ifndef __ASPARSEMATRIX_H</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#include &quot;<a class="code" href="asparsematrix_8hpp.html">asparsematrix.hpp</a>&quot;</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#ifndef __ALINALG_H</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#include &quot;alinalg.hpp&quot;</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#ifndef __ADATASTRUCTURES_H</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#include &quot;adatastructures.hpp&quot;</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="keyword">using namespace </span>std;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="keyword">using namespace </span>amat;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="keyword">namespace </span>acfd {</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="keyword">const</span> <span class="keywordtype">int</span> n_extra_fields_in_bface = 2;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment">// Unstructured triangular mesh class</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="keyword">class </span>UTriMesh</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;{</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="keyword">private</span>:</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="keywordtype">int</span> npoin;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <span class="keywordtype">int</span> nelem;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="keywordtype">int</span> ndim;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="keywordtype">int</span> nnode;      <span class="comment">// number of nodes to an element</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="keywordtype">int</span> nfael;      <span class="comment">// number of faces to an element (equal to number of edges to an element in 2D)</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="keywordtype">int</span> nnofa;      <span class="comment">// number of node in a face -- needs to be generalized in case of general grids</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="keywordtype">int</span> naface;     <span class="comment">// total number of (internal and boundary) faces</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="keywordtype">int</span> nbface;     <span class="comment">// number of boundary faces as calculated by compute_face_data(), as opposed to nface which is read from file</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="keywordtype">int</span> nbpoin;     <span class="comment">// number of boundary points</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="keywordtype">int</span> nface;      <span class="comment">// number of boundary faces - not always used</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="keywordtype">int</span> nbdata;     <span class="comment">// number of integers associated with each boundary point</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;double&gt;</a> coords;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;int&gt;</a> inpoel;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;int&gt;</a> bface;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;int&gt;</a> bpoints;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="comment">// The following 4 are for moving mesh</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;int&gt;</a> bflag;      <span class="comment">// for the basicspring mesh mpvement, and for output of interior node data</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;int&gt;</a> bflag2;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;double&gt;</a> cosa;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;double&gt;</a> sina;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;int&gt;</a> esup;       <span class="comment">// elements surrounding point</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;int&gt;</a> esup_p;     <span class="comment">// stores positions corresponding to points in esup</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;int&gt;</a> psup;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;int&gt;</a> psup_p;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;int&gt;</a> esuel;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;int&gt;</a> intfac;     <span class="comment">// naface x 4 matrix: holds for each face: (1) index of left element, (2) index of right element, (3) index of starting point of face, and (4) index of ending point of face</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;double&gt;</a> gallfa;  <span class="comment">//naface x 3 matrix: holds for each face: (1) x-component of normal (2) y-component of normal (3) Measure (length) of face. Note that normal points from left element towards right element (refer to intfac)</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="keywordtype">bool</span> alloc_jacobians;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;double&gt;</a> jacobians;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;double&gt;</a>* xb;         <span class="comment">// boundary displacements for mesh-movement</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;double&gt;</a>* yb;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    UTriMesh() {}</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    UTriMesh(<a class="code" href="classamat_1_1Matrix.html">Matrix&lt;double&gt;</a>* co, <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;int&gt;</a>* inp, <span class="keywordtype">int</span> n_poin, <span class="keywordtype">int</span> n_elem, <span class="keywordtype">int</span> n_node, <span class="keywordtype">int</span> n_nofa)</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    {</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        alloc_jacobians = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        coords = *co;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        inpoel = *inp;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        npoin = n_poin;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        nelem = n_elem;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        nnode = n_node;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        nnofa = n_nofa;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    }</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    UTriMesh(ifstream&amp; infile)</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    {</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        alloc_jacobians = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        <span class="comment">// Do file handling here to populate npoin and nelem</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;UTriMesh: Reading mesh file...\n&quot;</span>;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        <span class="keywordtype">char</span> ch = <span class="charliteral">&#39;\0&#39;</span>; <span class="keywordtype">int</span> dum = 0; <span class="keywordtype">double</span> dummy;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        <span class="comment">//infile &gt;&gt; ch;</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        infile &gt;&gt; dum;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        infile &gt;&gt; ch;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; 4; i++)      <span class="comment">//skip 4 lines</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;            <span class="keywordflow">do</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                ch = infile.get();</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;            <span class="keywordflow">while</span>(ch != <span class="charliteral">&#39;\n&#39;</span>);</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        infile &gt;&gt; ndim;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        infile &gt;&gt; nnode;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        infile &gt;&gt; ch;           <span class="comment">//get the newline</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        <span class="keywordflow">do</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;            ch = infile.get();</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        <span class="keywordflow">while</span>(ch != <span class="charliteral">&#39;\n&#39;</span>);</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        infile &gt;&gt; nelem; infile &gt;&gt; npoin; infile &gt;&gt; nbpoin;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        infile &gt;&gt; dummy;                <span class="comment">// get time</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        ch = infile.get();          <span class="comment">// clear newline</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;UTriMesh: Number of elements: &quot;</span> &lt;&lt; nelem &lt;&lt; <span class="stringliteral">&quot;, number of points: &quot;</span> &lt;&lt; npoin &lt;&lt; <span class="stringliteral">&quot;, number of nodes per element: &quot;</span> &lt;&lt; nnode &lt;&lt; endl;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;Number of boundary points: &quot;</span> &lt;&lt; nbpoin &lt;&lt; <span class="stringliteral">&quot;, Number of dimensions: &quot;</span> &lt;&lt; ndim;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        nbdata = 5;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        <span class="comment">//cout &lt;&lt; &quot;\nUTriMesh: Allocating coords..&quot;;</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        coords.setup(npoin, ndim, ROWMAJOR);</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        <span class="comment">//cout &lt;&lt; &quot;\nUTriMesh: Allocating inpoel..\n&quot;;</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        inpoel.setup(nelem, nnode, ROWMAJOR);</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        <span class="comment">//cout &lt;&lt; &quot;UTriMesh: Allocating bface...\n&quot;;</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        bpoints.setup(nbpoin, nbdata, ROWMAJOR);</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        nfael = 3;  <span class="comment">// number of faces per element</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        nnofa = 2;  <span class="comment">// number of nodes per face</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        <span class="comment">//cout &lt;&lt; &quot;UTriMesh: Allocation done.&quot;;</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        <span class="keywordflow">do</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;            ch = infile.get();</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        <span class="keywordflow">while</span>(ch != <span class="charliteral">&#39;\n&#39;</span>);</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        <span class="comment">//now populate inpoel</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; nelem; i++)</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        {</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;            infile &gt;&gt; dum;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j = 0; j &lt; nnode; j++)</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;                infile &gt;&gt; inpoel(i,j);</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;            <span class="keywordflow">do</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;                ch = infile.get();</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;            <span class="keywordflow">while</span>(ch != <span class="charliteral">&#39;\n&#39;</span>);</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        }</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;\nUTriMesh: Populated inpoel.&quot;</span>;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        <span class="comment">//Correct inpoel:</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; nelem; i++)</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        {</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j = 0; j &lt; nnode; j++)</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                inpoel(i,j)--;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        }</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        ch = infile.get();</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        <span class="keywordflow">do</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;            ch = infile.get();</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        <span class="keywordflow">while</span>(ch != <span class="charliteral">&#39;\n&#39;</span>);</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        <span class="comment">// populate coords</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; npoin; i++)</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        {</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;            infile &gt;&gt; dum;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j = 0; j &lt; ndim; j++)</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                infile &gt;&gt; coords(i,j);</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        }</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;\nUTriMesh: Populated coords.\n&quot;</span>;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <span class="comment">//coords.mprint();</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        ch = infile.get();</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; npoin+2; i++)</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        {</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;            <span class="keywordflow">do</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                ch = infile.get();</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;            <span class="keywordflow">while</span>(ch != <span class="charliteral">&#39;\n&#39;</span>);</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        }</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; nbpoin; i++)</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        {</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;            infile &gt;&gt; dum;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j = 0; j &lt; nbdata; j++)</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;            {</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                infile &gt;&gt; bpoints(i,j);</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;            }</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;            <span class="keywordflow">if</span> (i==nbpoin-1) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;            <span class="keywordflow">do</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                ch = infile.get();</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;            <span class="keywordflow">while</span>(ch!=<span class="charliteral">&#39;\n&#39;</span>);</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        }</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;UTriMesh: Populated bpoints. Done reading mesh.\n&quot;</span>;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        <span class="comment">//correct first 2 columns of bface</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        <span class="comment">/*for(int i = 0; i &lt; nface; i++)</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="comment">            for(int j = 0; j &lt; 2; j++)</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment">                bface(i,j)--;*/</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        <span class="comment">//------------- Calculate other topological properties -----------------</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;UTriMesh: Calculating and storing topological information...\n&quot;</span>;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        <span class="comment">//1. Elements surrounding points</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;UTriMesh: Elements surrounding points\n&quot;</span>;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        esup_p.setup(npoin+1,1,ROWMAJOR);</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        esup_p.zeros();</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; nelem; i++)</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        {</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j = 0; j &lt; nnode; j++)</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;            {</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                esup_p(inpoel(i,j)+1,0) += 1;           <span class="comment">// inpoel(i,j) + 1 : the + 1 is there because the storage corresponding to the first node begins at 0, not at 1</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;            }</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        }</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        <span class="comment">// Now make the members of esup_p cumulative</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 1; i &lt; npoin+1; i++)</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;            esup_p(i,0) += esup_p(i-1,0);</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        <span class="comment">// Now populate esup</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        esup.setup(esup_p(npoin,0),1,ROWMAJOR);</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        esup.zeros();</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; nelem; i++)</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        {</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j = 0; j &lt; nnode; j++)</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;            {</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                <span class="keywordtype">int</span> ipoin = inpoel(i,j);</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                esup(esup_p(ipoin,0),0) = i;        <span class="comment">// now put that element no. in the space pointed to by esup_p(ipoin)</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                esup_p(ipoin,0) += 1;               <span class="comment">// an element corresponding to ipoin has been found - increment esup_p for that point</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;            }</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        }</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        <span class="comment">//But now esup_p holds increased values - each member increased by the number elements surrounding the corresponding point.</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        <span class="comment">// So correct this.</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = npoin; i &gt;= 1; i--)</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;            esup_p(i,0) = esup_p(i-1,0);</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        esup_p(0,0) = 0;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        <span class="comment">// Elements surrounding points is now done.</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        <span class="comment">//2. Points surrounding points</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;UTriMesh: Points surrounding points\n&quot;</span>;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        psup_p.setup(npoin+1,1,ROWMAJOR);</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        psup_p.zeros();</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        psup_p(0,0) = 0;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;int&gt;</a> lpoin(npoin,1);  <span class="comment">// The ith member indicates the global point number of which the ith point is a surrounding point</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; npoin; i++) lpoin(i,0) = -1; <span class="comment">// initialize this vector to -1</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        <span class="keywordtype">int</span> istor = 0;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        <span class="comment">// first pass: calculate storage needed for psup</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ip = 0; ip &lt; npoin; ip++)</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        {</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;            lpoin(ip,0) = ip;       <span class="comment">// the point ip itself is not counted as a surrounding point of ip</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;            <span class="comment">// Loop over elements surrounding this point</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ie = esup_p(ip,0); ie &lt;= esup_p(ip+1,0)-1; ie++)</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;            {</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                <span class="keywordtype">int</span> ielem = esup(ie,0);     <span class="comment">// element number</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                <span class="comment">//loop over nodes of the element</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> inode = 0; inode &lt; nnode; inode++)</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                {</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                    <span class="comment">//Get global index of this node</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                    <span class="keywordtype">int</span> jpoin = inpoel(ielem, inode);</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                    <span class="keywordflow">if</span>(lpoin(jpoin,0) != ip)        <span class="comment">// test of this point as already been counted as a surrounding point of ip</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                    {</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                        istor++;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                        <span class="comment">//psup(istor,0) = jpoin;    // ! can&#39;t do this yet - psup not allocated!</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                        lpoin(jpoin,0) = ip;        <span class="comment">// set this point as a surrounding point of ip</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                    }</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                }</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;            }</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;            psup_p(ip+1,0) = istor;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        }</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        psup.setup(istor,1,ROWMAJOR);</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        <span class="comment">//cout &lt;&lt; &quot;+++ &quot; &lt;&lt; istor &lt;&lt; endl;</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        <span class="comment">//second pass: populate psup</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        istor = 0;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; npoin; i++) lpoin(i,0) = -1; <span class="comment">// initialize lpoin to -1</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ip = 0; ip &lt; npoin; ip++)</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        {</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;            lpoin(ip,0) = ip;       <span class="comment">// the point ip itself is not counted as a surrounding point of ip</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;            <span class="comment">// Loop over elements surrounding this point</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ie = esup_p(ip,0); ie &lt;= esup_p(ip+1,0)-1; ie++)</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;            {</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                <span class="keywordtype">int</span> ielem = esup(ie,0);     <span class="comment">// element number</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                <span class="comment">//loop over nodes of the element</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> inode = 0; inode &lt; nnode; inode++)</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                {</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;                    <span class="comment">//Get global index of this node</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;                    <span class="keywordtype">int</span> jpoin = inpoel(ielem, inode);</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;                    <span class="keywordflow">if</span>(lpoin(jpoin,0) != ip)        <span class="comment">// test of this point as already been counted as a surrounding point of ip</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;                    {</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;                        psup(istor,0) = jpoin;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;                        istor++;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;                        lpoin(jpoin,0) = ip;        <span class="comment">// set this point as a surrounding point of ip</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                    }</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;                }</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;            }</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;            <span class="comment">//psup_p(ip+1,0) = istor;</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        }</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        <span class="comment">//Points surrounding points is now done.</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        <span class="comment">// 3. Elements surrounding elements</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;UTriMesh: Elements surrounding elements...\n&quot;</span>;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        esuel.setup(nelem, nfael, ROWMAJOR);</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ii = 0; ii &lt; nelem; ii++)</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> jj = 0; jj &lt; nfael; jj++)</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;                esuel(ii,jj) = -1;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;int&gt;</a> lpofa(nfael, nnofa);    <span class="comment">// lpofa(i,j) holds local node number of jth node of ith face (j in {0,1}, i in {0,1,2})</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        lpofa(0,0) = 1; lpofa(0,1) = 2;</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        lpofa(1,0) = 2; lpofa(1,1) = 0;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        lpofa(2,0) = 0; lpofa(2,1) = 1;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;int&gt;</a> lhelp(nnofa,1);</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        lhelp.zeros();</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        lpoin.zeros();</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ielem = 0; ielem &lt; nelem; ielem++)</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        {</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ifael = 0; ifael &lt; nfael; ifael++)</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;            {</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; nnofa; i++)</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;                {</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                    lhelp(i,0) = inpoel(ielem, lpofa(ifael,i)); <span class="comment">// lhelp stores global node nos. of current face of current element</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;                    lpoin(lhelp(i,0)) = 1;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                }</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                <span class="keywordtype">int</span> ipoin = lhelp(0);</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> istor = esup_p(ipoin); istor &lt; esup_p(ipoin+1); istor++)</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                {</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;                    <span class="keywordtype">int</span> jelem = esup(istor);</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                    <span class="keywordflow">if</span>(jelem != ielem)</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                    {</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> jfael = 0; jfael &lt; nfael; jfael++)</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                        {</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;                            <span class="comment">//Assume that no. of nodes in face ifael is same as that in face jfael</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;                            <span class="keywordtype">int</span> icoun = 0;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;                            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> jnofa = 0; jnofa &lt; nnofa; jnofa++)</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;                            {</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;                                <span class="keywordtype">int</span> jpoin = inpoel(jelem, lpofa(jfael,jnofa));</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;                                <span class="keywordflow">if</span>(lpoin(jpoin)==1) icoun++;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;                            }</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;                            <span class="keywordflow">if</span>(icoun == nnofa)      <span class="comment">// nnofa is 2</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;                            {</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;                                esuel(ielem,ifael) = jelem;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;                                esuel(jelem,jfael) = ielem;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;                            }</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;                        }</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                    }</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                }</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; nnofa; i++)</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                    lpoin(lhelp(i)) = 0;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;            }</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        }</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        <span class="comment">//cout &lt;&lt; &quot;UTriMesh: Elements surrounding elements done.\n&quot;;</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;UTriMesh: Done.\n&quot;</span>;</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    }</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    UTriMesh(UTriMesh&amp; other)</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    {</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        <span class="comment">/*npoin = other.npoin;</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment">        nelem = other.nelem;</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment">        nface = other.nface;</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="comment">        ndim = other.ndim;</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="comment">        nnode = other.nnode;</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="comment">        coords = other.coords;</span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="comment">        inpoel = other.inpoel;</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment">        bface = other.bface; */</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;        npoin = other.npoin;</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        nelem = other.nelem;</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;        nbpoin = other.nbpoin;</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        nface = other.nface;</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        ndim = other.ndim;</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;        nnode = other.nnode;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        naface = other.naface;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        nbface = other.nbface;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        nfael = other.nfael;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        nnofa = other.nnofa;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;        coords = other.coords;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        inpoel = other.inpoel;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        bpoints = other.bpoints;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;        esup = other.esup;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        esup_p = other.esup_p;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        psup = other.psup;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        psup_p = other.psup_p;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;        esuel = other.esuel;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        intfac = other.intfac;</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        gallfa = other.gallfa;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        alloc_jacobians = other.alloc_jacobians;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        jacobians = other.jacobians;</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    }</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    UTriMesh&amp; operator=(UTriMesh&amp; other)</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    {</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        npoin = other.npoin;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;        nelem = other.nelem;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;        nbpoin = other.nbpoin;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        nface = other.nface;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;        ndim = other.ndim;</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        nnode = other.nnode;</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        naface = other.naface;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        nbface = other.nbface;</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        nfael = other.nfael;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        nnofa = other.nnofa;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        coords = other.coords;</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        inpoel = other.inpoel;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        bpoints = other.bpoints;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        esup = other.esup;</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        esup_p = other.esup_p;</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        psup = other.psup;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        psup_p = other.psup_p;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;        esuel = other.esuel;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;        intfac = other.intfac;</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;        gallfa = other.gallfa;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;        alloc_jacobians = other.alloc_jacobians;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;        jacobians = other.jacobians;</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;        <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    }</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <span class="keywordtype">void</span> readYibinMesh(<span class="keywordtype">string</span> meshn)</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    {</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        <span class="comment">/* Reads Yibin Wang&#39;s dat mesh format, which does not contain any boundary information. */</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        ifstream fin(meshn);</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;        fin &gt;&gt; npoin &gt;&gt; nelem;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;        <span class="comment">// some assumptions for properties not specified in the file</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;        ndim = 2; nnode = 4; nnofa = 2; nfael = 4;</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;        <span class="keywordtype">int</span> a;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        coords.setup(npoin,ndim);</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        inpoel.setup(nelem,nnode);</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ipoin = 0; ipoin &lt; npoin; ipoin++)</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        {</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> idim = 0; idim &lt; ndim; idim++)</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;                fin &gt;&gt; coords(ipoin,idim);</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        }</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ielem = 0; ielem &lt; nelem; ielem++)</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        {</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> inode = 0; inode &lt; nnode; inode++) {</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;                fin &gt;&gt; a;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;                inpoel(ielem,inode) = a - 1;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;            }</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;        }</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;        <span class="comment">// finished reading mesh file</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        fin.close();</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;        <span class="comment">// Now populate bface and bpoints</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;        <span class="comment">// NOTE: only works for structured mesh!</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;int&gt;</a> lpoin(npoin,1);</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;        lpoin.zeros();</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ielem = 0; ielem &lt; nelem; ielem++)</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;        {</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> inode = 0; inode &lt; nnode; inode++)</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;                lpoin(inpoel(ielem,inode))++;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;        }</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        nbpoin = 0;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;        nface = 0;</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; npoin; i++)</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;            <span class="keywordflow">if</span>(lpoin(i) &lt;= 3) nbpoin++;</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;        bpoints.setup(nbpoin,1+2);      <span class="comment">// stores global point number and surrounding bfaces for each bpoint</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ielem = 0; ielem &lt; nelem; ielem++)</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;        {</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;            <span class="keywordtype">int</span> nextnode;</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> inode = 0; inode &lt; nnode; inode++)</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;            {</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;                nextnode = perm(0,nnode-1,inode,1);</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;                <span class="keywordflow">if</span>(lpoin.get(inpoel(ielem,inode)) &lt;= 3 &amp;&amp; lpoin.get(inpoel.get(ielem,nextnode)) &lt;= 3) {</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;                    nface++;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;                }</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;            }</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        }</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        bface.setup(nface,nnofa+n_extra_fields_in_bface);</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        bface.zeros();</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;int&gt;</a> trav(npoin,1);</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;        trav.zeros();</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;        <span class="keywordtype">int</span> k = 0, l = 0;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ielem = 0; ielem &lt; nelem; ielem++)</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        {</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;            <span class="keywordtype">int</span> thisgnode, nextnode, nextgnode;</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> inode = 0; inode &lt; nnode; inode++)</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;            {</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;                thisgnode = inpoel(ielem,inode);</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;                <span class="keywordflow">if</span>(lpoin(thisgnode) &lt;= 3 &amp;&amp; trav(thisgnode)==0) {</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;                    bpoints(l,0) = thisgnode;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;                    bpoints(l,1) = 1;</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;                    trav(thisgnode) = 1;</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;                    l++;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;                }</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;                nextnode = perm(0,nnode-1,inode,1);</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;                nextgnode = inpoel(ielem,nextnode);</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;                <span class="keywordflow">if</span>(lpoin.get(thisgnode) &lt;= 3 &amp;&amp; lpoin.get(nextgnode) &lt;= 3) {</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;                    bface(k,0) = nextgnode;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;                    bface(k,1) = thisgnode;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;                    bface(k,2) = 1;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;                    k++;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;                }</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;            }</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;        }</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;        <span class="comment">// we now have bpoints and bface for a structured mesh.</span></div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;UTriMesh: readYibinMesh(): &quot;</span> &lt;&lt; npoin &lt;&lt; <span class="stringliteral">&quot; points, &quot;</span> &lt;&lt; nelem &lt;&lt; <span class="stringliteral">&quot; elements, &quot;</span> &lt;&lt; nface &lt;&lt; <span class="stringliteral">&quot; boundary faces, &quot;</span> &lt;&lt; nbpoin &lt;&lt; <span class="stringliteral">&quot; boundary points.&quot;</span> &lt;&lt; endl;</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    }</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    <span class="comment">// Returns x or y coordinate (depending on dim) of node number pointno. Numbering of points begins</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    <span class="comment">// from 0. Numbering of dimensions begins from 0.</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    <span class="keywordtype">double</span> gcoords(<span class="keywordtype">int</span> pointno, <span class="keywordtype">int</span> dim)</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    {</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        <span class="keywordflow">return</span> coords.get(pointno,dim);</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    }</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    <span class="comment">// Returns global node number of locnode th local node of element number elemno. Numberings for both</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <span class="comment">// begins from 0</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    <span class="keywordtype">int</span> ginpoel(<span class="keywordtype">int</span> elemno, <span class="keywordtype">int</span> locnode)</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    {</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        <span class="keywordflow">return</span> inpoel.get(elemno, locnode);</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    }</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;    <span class="keywordtype">int</span> gbpoints(<span class="keywordtype">int</span> pointno, <span class="keywordtype">int</span> val)</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    {</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;        <span class="keywordflow">return</span> bpoints.get(pointno, val);</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    }</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    <span class="keywordtype">void</span> setcoords(<a class="code" href="classamat_1_1Matrix.html">Matrix&lt;double&gt;</a>* c)</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    { coords = *c; }</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    <span class="keywordtype">void</span> setinpoel(<a class="code" href="classamat_1_1Matrix.html">Matrix&lt;int&gt;</a>* inp)</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    { inpoel = *inp; }</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <span class="keywordtype">void</span> setbpoints(<a class="code" href="classamat_1_1Matrix.html">Matrix&lt;int&gt;</a>* bf)</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    { bpoints = *bf; }</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;double&gt;</a>* getcoords()</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    { <span class="keywordflow">return</span> &amp;coords; }</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    <span class="keywordtype">int</span> gesup(<span class="keywordtype">int</span> i) { <span class="keywordflow">return</span> esup.get(i); }</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    <span class="keywordtype">int</span> gesup_p(<span class="keywordtype">int</span> i) { <span class="keywordflow">return</span> esup_p.get(i); }</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    <span class="keywordtype">int</span> gpsup(<span class="keywordtype">int</span> i) { <span class="keywordflow">return</span> psup.get(i); }</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    <span class="keywordtype">int</span> gpsup_p(<span class="keywordtype">int</span> i) { <span class="keywordflow">return</span> psup_p.get(i); }</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    <span class="keywordtype">int</span> gesuel(<span class="keywordtype">int</span> ielem, <span class="keywordtype">int</span> jnode) { <span class="keywordflow">return</span> esuel.get(ielem, jnode); }        <span class="comment">//returns element number at face opposite to node number jnode</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    <span class="keywordtype">double</span> gjacobians(<span class="keywordtype">int</span> ielem) { <span class="keywordflow">return</span> jacobians(ielem,0); }</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    <span class="keywordtype">int</span> gnpoin() { <span class="keywordflow">return</span> npoin; }</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    <span class="keywordtype">int</span> gnelem() { <span class="keywordflow">return</span> nelem; }</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    <span class="keywordtype">int</span> gnbface() { <span class="keywordflow">return</span> nbface; }</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    <span class="keywordtype">int</span> gnbpoin() { <span class="keywordflow">return</span> nbpoin; }</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    <span class="keywordtype">int</span> gnnode() { <span class="keywordflow">return</span> nnode; }</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    <span class="keywordtype">int</span> gndim() { <span class="keywordflow">return</span> ndim; }</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <span class="keywordtype">int</span> gnaface() {<span class="keywordflow">return</span> naface; }</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    <span class="keywordtype">int</span> gnfael() { <span class="keywordflow">return</span> nfael; }</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    <span class="keywordtype">int</span> gnnofa() { <span class="keywordflow">return</span> nnofa; }</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <span class="keywordtype">int</span> gnbdata() {<span class="keywordflow">return</span> nbdata; }</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <span class="keywordtype">void</span> compute_jacobians()</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    {</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;        <span class="keywordflow">if</span> (alloc_jacobians == <span class="keyword">false</span>)</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;        {</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;            jacobians.setup(nelem, 1, ROWMAJOR);</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;            alloc_jacobians = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;        }</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; gnelem(); i++)</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        {</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;            <span class="comment">// geoel(i,0) = D(i) = a1*b2 - a2*b1 :</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;            jacobians(i,0) = gcoords(ginpoel(i,0),0)*(gcoords(ginpoel(i,1),1) - gcoords(ginpoel(i,2),1)) - gcoords(ginpoel(i,0),1)*(gcoords(ginpoel(i,1),0)-gcoords(ginpoel(i,2),0)) + gcoords(ginpoel(i,1),0)*gcoords(ginpoel(i,2),1) - gcoords(ginpoel(i,2),0)*gcoords(ginpoel(i,1),1);</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;        }</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    }</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    <span class="keywordtype">void</span> detect_negative_jacobians(ofstream&amp; out)</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    {</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;        <span class="keywordtype">bool</span> flagj = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; nelem; i++)</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;        {</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;            <span class="keywordflow">if</span>(jacobians(i,0) &lt;= 1e-15) {</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;                out &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; jacobians(i,0) &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;                flagj = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;            }</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;        }</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;        <span class="keywordflow">if</span>(flagj == <span class="keyword">true</span>) cout &lt;&lt; <span class="stringliteral">&quot;UTriMesh: detect_negative_jacobians(): There exist element(s) with negative jacobian!!\n&quot;</span>;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    }</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <span class="keywordtype">void</span> compute_face_data()</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    <span class="comment">/* Computes, for each face, the elements on either side, the starting node and the ending node of the face. This is stored in intfac. Also computes unit normals to, and lengths of, each face as well as boundary flags of boundary faces, in gallfa.</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;<span class="comment">    NOTE: After this function, esuel holds (nelem + face no.) for each ghost cell, instead of -1 as before.*/</span></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    {</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;        nbface = naface = 0;</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        <span class="comment">// first run: calculate nbface</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ie = 0; ie &lt; nelem; ie++)</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        {</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> in = 0; in &lt; nnode; in++)</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;            {</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;                <span class="comment">//int in1 = perm(0,nnode-1,in,1);</span></div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;                <span class="comment">//int in2 = perm(0,nnode-1,in1,1);</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;                <span class="keywordtype">int</span> je = esuel(ie,in);</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;                <span class="keywordflow">if</span>(je == -1)</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;                {</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;                    <span class="comment">//esuel(ie,in) = nelem+nbface;</span></div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;                    nbface++;</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;                }</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;            }</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;        }</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;UTriMesh: compute_face_data(): Number of boundary faces = &quot;</span> &lt;&lt; nbface &lt;&lt; endl;</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;        <span class="comment">// calculate number of internal faces</span></div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;        naface = nbface;</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ie = 0; ie &lt; nelem; ie++)</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;        {</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> in = 0; in &lt; nnode; in++)</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;            {</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;                <span class="comment">//int in1 = perm(0,nnode-1,in,1);</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;                <span class="comment">//int in2 = perm(0,nnode-1,in1,1);</span></div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;                <span class="keywordtype">int</span> je = esuel(ie,in);</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;                <span class="keywordflow">if</span>(je &gt; ie &amp;&amp; je &lt; nelem) naface++;</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;            }</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;        }</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;UTriMesh: compute_face_data(): Number of all faces = &quot;</span> &lt;&lt; naface &lt;&lt; endl;</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;        <span class="comment">//allocate intfac</span></div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;        intfac.setup(naface,4,ROWMAJOR);</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;        <span class="comment">//reset face totals</span></div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;        nbface = naface = 0;</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;        <span class="comment">//second run: populate intfac</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ie = 0; ie &lt; nelem; ie++)</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        {</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> in = 0; in &lt; nnode; in++)</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;            {</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;                <span class="keywordtype">int</span> in1 = perm(0,nnode-1,in,1);</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;                <span class="keywordtype">int</span> in2 = perm(0,nnode-1,in1,1);</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;                <span class="keywordtype">int</span> je = esuel(ie,in);</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;                <span class="keywordflow">if</span>(je == -1)</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;                {</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;                    esuel(ie,in) = nelem+nbface;</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;                    intfac(nbface,0) = ie;</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;                    intfac(nbface,1) = nelem+nbface;</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;                    intfac(nbface,2) = inpoel(ie,in1);</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;                    intfac(nbface,3) = inpoel(ie,in2);</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;                    nbface++;</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;                }</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;            }</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;        }</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;        naface = nbface;</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ie = 0; ie &lt; nelem; ie++)</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;        {</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> in = 0; in &lt; nnode; in++)</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;            {</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;                <span class="keywordtype">int</span> in1 = perm(0,nnode-1,in,1);</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;                <span class="keywordtype">int</span> in2 = perm(0,nnode-1,in1,1);</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;                <span class="keywordtype">int</span> je = esuel(ie,in);</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;                <span class="keywordflow">if</span>(je &gt; ie &amp;&amp; je &lt; nelem)</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;                {</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;                    intfac(naface,0) = ie;</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;                    intfac(naface,1) = je;</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;                    intfac(naface,2) = inpoel(ie,in1);</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;                    intfac(naface,3) = inpoel(ie,in2);</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;                    naface++;</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;                }</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;            }</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;        }</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;        <span class="comment">//Now compute normals and lengths</span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;        gallfa.setup(naface, 3, ROWMAJOR);</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; naface; i++)</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;        {</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;            gallfa(i,0) = coords(intfac(i,3),1) - coords(intfac(i,2),1);</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;            gallfa(i,1) = -1.0*(coords(intfac(i,3),0) - coords(intfac(i,2),0));</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;            gallfa(i,2) = sqrt(pow(gallfa(i,0),2) + pow(gallfa(i,1),2));</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;            <span class="comment">//Normalize the normal vector components</span></div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;            gallfa(i,0) /= gallfa(i,2);</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;            gallfa(i,1) /= gallfa(i,2);</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;        }</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;UTriMesh: compute_face_data(): Done.\n&quot;</span>;</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    }</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    <span class="keywordtype">void</span> compute_lengths_and_normals()      <span class="comment">// Also happening in compute_face_data</span></div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    {</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; naface; i++)</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;        {</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;            gallfa(i,0) = coords(intfac(i,3),1) - coords(intfac(i,2),1);</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;            gallfa(i,1) = -1.0*(coords(intfac(i,3),0) - coords(intfac(i,2),0));</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;            gallfa(i,2) = sqrt(pow(gallfa(i,0),2) + pow(gallfa(i,1),2));</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;            <span class="comment">//Normalize the normal vector components</span></div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;            gallfa(i,0) /= gallfa(i,2);</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;            gallfa(i,1) /= gallfa(i,2);</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;        }</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    }</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    <span class="keywordtype">void</span> allocate_edge_angles()     <span class="comment">// call only after calling compute_face_data()</span></div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    {</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;        cosa.setup(naface,1);</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;        sina.setup(naface,1);</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    }</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;    <span class="keywordtype">void</span> compute_edge_angles()</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    {</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;UTriMesh: Computing edge angles...\n&quot;</span>;</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;        <span class="comment">// calculate cos(a) and sin(a) where &#39;a&#39; is angle made by edge (face in 2D) with the x axis</span></div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ied = 0; ied &lt; naface; ied++)</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;        {</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;            cosa(ied) = -gallfa(ied,1)/gallfa(ied,2);</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;            sina(ied) = gallfa(ied,0)/gallfa(ied,2);</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;        }</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    }</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    <span class="keywordtype">int</span> gintfac(<span class="keywordtype">int</span> face, <span class="keywordtype">int</span> i) { <span class="keywordflow">return</span> intfac.get(face,i); }</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    <span class="keywordtype">double</span> ggallfa(<span class="keywordtype">int</span> elem, <span class="keywordtype">int</span> i) {<span class="keywordflow">return</span> gallfa.get(elem,i); }</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    <span class="keywordtype">void</span> writeGmsh2(<span class="keywordtype">string</span> mfile)</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    {</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;        ofstream outf(mfile);</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;        outf &lt;&lt; <span class="stringliteral">&quot;$MeshFormat\n2.2 0 8\n$EndMeshFormat\n&quot;</span>;</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;        outf &lt;&lt; <span class="stringliteral">&quot;$Nodes\n&quot;</span> &lt;&lt; npoin &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ip = 0; ip &lt; npoin; ip++)</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;        {</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;            outf &lt;&lt; ip+1 &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; coords(ip,0) &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; coords(ip,1) &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; 0 &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;        }</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;        outf &lt;&lt; <span class="stringliteral">&quot;$EndNodes\n$Elements\n&quot;</span> &lt;&lt; nelem<span class="comment">/*+nface*/</span> &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;        <span class="comment">// boundary faces first</span></div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;        <span class="comment">/*for(int iface = 0; iface &lt; nface; iface++)</span></div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;<span class="comment">        {</span></div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;<span class="comment">            outf &lt;&lt; iface+1 &lt;&lt; &quot; 1 2 0 1&quot;;</span></div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;<span class="comment">            for(int i = 0; i &lt; nnofa; i++)</span></div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;<span class="comment">                outf &lt;&lt; &quot; &quot; &lt;&lt; bface(iface,i)+1;</span></div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;<span class="comment">            outf &lt;&lt; &#39;\n&#39;;</span></div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;<span class="comment">        }*/</span></div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iel = 0; iel &lt; nelem; iel++)</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;        {</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;            outf &lt;&lt; <span class="comment">/*nface+*/</span>iel+1 &lt;&lt; <span class="stringliteral">&quot; 2 2 0 2&quot;</span>;</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; nnode; i++)</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;                outf &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; inpoel(iel,i)+1;</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;            outf &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;        }</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;        outf &lt;&lt; <span class="stringliteral">&quot;$EndElements\n&quot;</span>;</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;        outf.close();</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    }</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    <span class="comment">//------------------------- Mesh movement functions -----------------------------------//</span></div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    <span class="keywordtype">void</span> movemesh(<a class="code" href="classamat_1_1Matrix.html">Matrix&lt;double&gt;</a> disp)</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    <span class="comment">// Updates coords of mesh by adding displacements to them; the displacements specified by the 2*npoin-by-1 vector disp, which contains x-displacements in the first npoin entries and y-displacements in the rest.</span></div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    <span class="comment">// Required for elasticity-based mesh movement.</span></div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;    {</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ip = 0; ip &lt; npoin; ip++)</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;        {</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;            coords(ip,0) += disp(ip);</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;            coords(ip,1) += disp(npoin+ip);</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        }</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    }</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    </div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    <span class="keywordtype">void</span> set_boundary_motion(<a class="code" href="classamat_1_1Matrix.html">Matrix&lt;double&gt;</a>* xx, <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;double&gt;</a>* yy)</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    {</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;        xb = xx; yb = yy;</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    }</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    <span class="keywordtype">void</span> setbflags2()</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    {</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;        bflag2.<a class="code" href="classamat_1_1Matrix.html#a6d05d3393c5f98780f91daf9d2bbf82a">setup</a>(2*npoin,1);</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; 2*nbpoin; i+=2)</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;        {</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;            bflag2(i) = 1;</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;            bflag2(i+1) = 1;</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;        }</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    }</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    <span class="comment">// returns stiffness of the edge between global nodes i and j</span></div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    <span class="keywordtype">double</span> k(<span class="keywordtype">int</span> i, <span class="keywordtype">int</span> j)</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;    {</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;         <span class="keywordflow">return</span> 1/sqrt((gcoords(i,0)-gcoords(j,0))*(gcoords(i,0)-gcoords(j,0)) + (gcoords(i,1)-gcoords(j,1))*(gcoords(i,1)-gcoords(j,1)));</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;    }</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;    <span class="comment">// Moves the mesh according to prescribed boundary displacements xb and yb</span></div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;    <span class="comment">// blfag contains a 0-or-1 flag that indicates a boundary point</span></div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;    <span class="comment">// Note that the original mesh is overwritten.</span></div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    <span class="comment">// NOTE: MAKE SURE to update geoel, gallfa and any other downstream data</span></div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    <span class="keywordtype">void</span> movemesh_basicspring(<a class="code" href="classamat_1_1Matrix.html">Matrix&lt;double&gt;</a> xb, <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;double&gt;</a> yb, <span class="keywordtype">string</span> solver, <span class="keywordtype">double</span> tol=1e-6, <span class="keywordtype">int</span> maxiter=1000)</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    {</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;        <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;double&gt;</a> A(npoin, npoin, ROWMAJOR);</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;        A.zeros();</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;movemesh_basicspring: Assembling stiffness matrix\n&quot;</span>;</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;        <span class="comment">// Essentially, we&#39;re solving a homogeneous discrete elliptic equation with Dirichlet BCs</span></div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ip = 0; ip &lt; npoin; ip++)</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;        {</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = psup_p(ip,0); i &lt;= psup_p(ip+1,0)-1; i++)</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;            {</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;                <span class="keywordtype">int</span> ipoin = psup(i,0);</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;                A(ip,ip) += k(ip,ipoin);</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;                A(ip,ipoin) -= k(ip,ipoin);</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;            }</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;        }</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;        <span class="comment">//ofstream ofile(&quot;stiffmat.dat&quot;);</span></div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;        <span class="comment">//A.fprint(ofile);</span></div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;        <span class="comment">//ofile.close();</span></div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;movemesh2d_bs: Setting up boundary conditions\n&quot;</span>;</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;        <span class="keywordtype">double</span> cbig = 1e30;         <span class="comment">// big number for Dirichlet BCs</span></div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;        <span class="comment">// apply Dirichlet BCs using cbig</span></div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; npoin; i++)</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;        {</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;            <span class="keywordflow">if</span>(bflag(i,0) == 1)</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;            {</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;                xb(i,0) *= (cbig * A(i,i));</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;                yb(i,0) *= (cbig * A(i,i));</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;                A(i,i) *= cbig;</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;            }</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;        }</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;        <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;double&gt;</a> dx(npoin,1);</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;        <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;double&gt;</a> dy(npoin,2);</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;        <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;double&gt;</a> initvals(npoin,1);</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;        initvals.zeros();</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;        <span class="comment">//solve for the displacements</span></div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;movemesh_basicspring: Solving mesh-movement equations\n&quot;</span>;</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;        <span class="keywordflow">if</span>(solver == <span class="stringliteral">&quot;cholesky&quot;</span>)</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;        {</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;            dx = <a class="code" href="namespaceamat.html#a2792c2bc650a2476343c001056620f0e">cholesky</a>(A,xb);</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;            dy = <a class="code" href="namespaceamat.html#a2792c2bc650a2476343c001056620f0e">cholesky</a>(A,yb);</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;        }</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (solver == <span class="stringliteral">&quot;gausselim&quot;</span>)</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;        {</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;            dx = <a class="code" href="namespaceamat.html#afae9ae0c89f02718f6e68d3e5d3960ac">gausselim</a>(A,xb);</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;            dy = <a class="code" href="namespaceamat.html#afae9ae0c89f02718f6e68d3e5d3960ac">gausselim</a>(A,yb);</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;        }</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (solver == <span class="stringliteral">&quot;pointjacobi&quot;</span>)</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;        {</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;            dx = <a class="code" href="namespaceamat.html#aa656601bbd4193d1d21a150dc26d9923">pointjacobi</a>(A, xb, initvals, tol, maxiter, <span class="charliteral">&#39;n&#39;</span>);</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;            dy = <a class="code" href="namespaceamat.html#aa656601bbd4193d1d21a150dc26d9923">pointjacobi</a>(A, yb, initvals, tol, maxiter, <span class="charliteral">&#39;n&#39;</span>);</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;        }</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (solver == <span class="stringliteral">&quot;gaussseidel&quot;</span>)</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;        {</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;            dx = <a class="code" href="namespaceamat.html#aa4ae493e01024d481b1ee27d5c79d6c6">gaussseidel</a>(A, xb, initvals, tol, maxiter, <span class="charliteral">&#39;n&#39;</span>);</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;            dy = <a class="code" href="namespaceamat.html#aa4ae493e01024d481b1ee27d5c79d6c6">gaussseidel</a>(A, yb, initvals, tol, maxiter, <span class="charliteral">&#39;n&#39;</span>);</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;        }</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;        <span class="keywordflow">else</span> cout &lt;&lt; <span class="stringliteral">&quot;movemesh_basicspring: Solver &quot;</span> &lt;&lt; solver &lt;&lt; <span class="stringliteral">&quot; not found.\n&quot;</span>;</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;movemesh_basicspring: Mesh-movement equations solved.\n&quot;</span>;</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;        <span class="comment">//update coordinates</span></div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; npoin; i++)</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;        {</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;            coords(i,0) += dx(i,0);</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;            coords(i,1) += dy(i,0);</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;        }</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;        <span class="comment">//update jacobians</span></div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;        compute_jacobians();</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;        <span class="comment">// Also need to update length of faces, normals to faces in gallfa</span></div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;        compute_lengths_and_normals();</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    }</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    <span class="keywordtype">void</span> movemesh_lineal(<a class="code" href="classamat_1_1Matrix.html">Matrix&lt;double&gt;</a>* xb, <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;double&gt;</a>* yb, <span class="keywordtype">string</span> solver, <span class="keywordtype">double</span> tol=1e-6, <span class="keywordtype">int</span> maxiter=1000)</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    {</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;UTriMesh: movemesh_farhat(): Starting\n&quot;</span>;</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;        <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;double&gt;</a> Kg(2*npoin,2*npoin);     <span class="comment">// global stiffness matrix</span></div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;        Kg.zeros();</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;        <span class="comment">//Matrix&lt;double&gt; kli(4,4);              // lineal stiffness matrix for an edge (face in 2D)</span></div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;        <span class="keywordtype">double</span> k11, k12, k22;</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;        <span class="keywordtype">double</span> len;</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;        <span class="keywordtype">int</span> ipx, ipy, jpx, jpy;</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ied = 0; ied &lt; naface; ied++)</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;        {</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;            <span class="comment">//gather</span></div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;            len = gallfa(ied,2);</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;            k11 = cosa(ied)*cosa(ied)/len;</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;            k12 = sina(ied)*cosa(ied)/len;</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;            k22 = sina(ied)*sina(ied)/len;</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;            ipx = 2*intfac(ied,2);</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;            ipy = 2*intfac(ied,2)+1;</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;            jpx = 2*intfac(ied,3);</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;            jpy = 2*intfac(ied,3)+1;</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;            <span class="comment">//scatter</span></div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;            Kg(ipx,ipx) += k11;         <span class="comment">// contribution by x-displacement of ip node to x-force at ip node</span></div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;            Kg(ipx,ipy) += k12;         <span class="comment">// contribution by y-displacement of ip node to x-force at ip node</span></div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;            Kg(ipx,jpx) += -k11;</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;            Kg(ipx,jpy) += -k12;</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;            Kg(ipy,ipx) += k12;</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;            Kg(ipy,ipy) += k22;</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;            Kg(ipy,jpx) += -k12;</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;            Kg(ipy,jpy) += -k22;</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;            Kg(jpx,ipx) += -k11;</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;            Kg(jpx,ipy) += -k12;</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;            Kg(jpx,jpx) += k11;</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;            Kg(jpx,jpy) += k12;</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;            Kg(jpy,ipx) += -k12;</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;            Kg(jpy,ipy) += -k22;</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;            Kg(jpy,jpx) += k12;</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;            Kg(jpy,jpy) += k22;</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;        }</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;UTriMesh: movemesh_farhat(): Done iterating over edges.\n&quot;</span>;</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;        <span class="comment">//Set boundary condtions</span></div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;        <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;double&gt;</a> b(2*npoin,1);</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; 2*npoin; i=i+2)</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;        {</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;            b(i) = (*xb)(i/2);</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;            b(i+1) = (*yb)(i/2);</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;        }</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;        <span class="keywordtype">double</span> cbig = 1e30;         <span class="comment">// big number for Dirichlet BCs</span></div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;        <span class="comment">// apply Dirichlet BCs using cbig</span></div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; 2*npoin; i++)</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;        {</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;            <span class="keywordflow">if</span>(bflag2(i,0) == 1)</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;            {</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;                b(i,0) *= (cbig * Kg(i,i));</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;                Kg(i,i) *= cbig;</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;            }</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;        }</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;UTriMesh: movemesh_farhat(): BCs set.\n&quot;</span>;</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;        <span class="comment">//Solve</span></div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;movemesh_farhat: Solving mesh-movement equations\n&quot;</span>;</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;        <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;double&gt;</a> dr(2*npoin,1);</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;        <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;double&gt;</a> initvals(2*npoin,1);</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;        initvals.zeros();</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;        <span class="keywordflow">if</span>(solver == <span class="stringliteral">&quot;cholesky&quot;</span>)</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;        {</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;            dr = <a class="code" href="namespaceamat.html#a2792c2bc650a2476343c001056620f0e">cholesky</a>(Kg,b);</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;        }</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (solver == <span class="stringliteral">&quot;gausselim&quot;</span>)</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;        {</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;            dr = <a class="code" href="namespaceamat.html#afae9ae0c89f02718f6e68d3e5d3960ac">gausselim</a>(Kg,b);</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;        }</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (solver == <span class="stringliteral">&quot;pointjacobi&quot;</span>)</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;        {</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;            dr = <a class="code" href="namespaceamat.html#aa656601bbd4193d1d21a150dc26d9923">pointjacobi</a>(Kg, b, initvals, tol, maxiter, <span class="charliteral">&#39;n&#39;</span>);</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;        }</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (solver == <span class="stringliteral">&quot;gaussseidel&quot;</span>)</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;        {</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;            dr = <a class="code" href="namespaceamat.html#aa4ae493e01024d481b1ee27d5c79d6c6">gaussseidel</a>(Kg, b, initvals, tol, maxiter, <span class="charliteral">&#39;n&#39;</span>);</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;        }</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;        <span class="keywordflow">else</span> cout &lt;&lt; <span class="stringliteral">&quot;movemesh_farhat: Solver &quot;</span> &lt;&lt; solver &lt;&lt; <span class="stringliteral">&quot; not found.\n&quot;</span>;</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;movemesh_farhat: Mesh-movement equations solved.\n&quot;</span>;</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;        <span class="comment">//update coordinates</span></div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; npoin; i++)</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;        {</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;            coords(i,0) += dr(2*i);</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;            coords(i,1) += dr(2*i+1);</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;        }</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;        <span class="comment">//update jacobians</span></div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;        compute_jacobians();</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;        <span class="comment">// Also need to update length of faces, normals to faces in gallfa</span></div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;        compute_lengths_and_normals();</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;        compute_edge_angles();</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;    }</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;    <span class="keywordtype">void</span> movemesh_farhat(<span class="keywordtype">double</span> tol, <span class="keywordtype">int</span> maxiter)</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;    <span class="comment">/* Moves the mesh based on boundary displacements set by the set_boundary_motion() method. The technique is based on Farhat et al&#39;s 2D torsional</span></div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;<span class="comment">       spring analogy method.</span></div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;<span class="comment">    */</span></div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;    {</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;UTriMesh: movemesh_farhat(): Starting\n&quot;</span>;</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;        <a class="code" href="classamat_1_1MatrixCRS.html">SpMatrix</a> Kg(2*npoin,2*npoin);       <span class="comment">// global stiffness matrix</span></div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;        <span class="comment">//Kg.zeros();</span></div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;        <span class="comment">//Matrix&lt;double&gt; kli(4,4);              // lineal stiffness matrix for an edge (face in 2D)</span></div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;        <span class="keywordtype">double</span> k11, k12, k22;</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;        <span class="keywordtype">double</span> len;</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;        <span class="keywordtype">int</span> ipx, ipy, jpx, jpy;</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;        <span class="keywordtype">int</span> ied;</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;        <span class="comment">// copy class variables to local variables for use in OpenMP</span></div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;        <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;double&gt;</a>* cosa = &amp;(UTriMesh::cosa);</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;        <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;double&gt;</a>* sina = &amp;(UTriMesh::sina);</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;        <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;double&gt;</a>* gallfa = &amp;(UTriMesh::gallfa);</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;        <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;int&gt;</a>* intfac = &amp;(UTriMesh::intfac);</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;        <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;double&gt;</a>* jacobians = &amp;(UTriMesh::jacobians);</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;<span class="preprocessor">        #ifdef _OPENMP</span></div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;<span class="preprocessor"></span>        <span class="keywordtype">int</span> naface = UTriMesh::naface;</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;        <span class="keywordtype">int</span> nnode = UTriMesh::nnode;</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;        <span class="keywordtype">int</span> nelem = UTriMesh::nelem;</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;<span class="preprocessor">        #endif</span></div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;<span class="preprocessor">        #pragma omp parallel for default(none) private(ied,len,k11,k12,k22,ipx,ipy,jpx,jpy) shared(naface,gallfa,cosa,sina,intfac,Kg) num_threads(nthreads_mesh)</span></div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;<span class="preprocessor"></span>        <span class="keywordflow">for</span>(ied = 0; ied &lt; naface; ied++)</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;        {</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;            <span class="comment">//gather</span></div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;            len = gallfa-&gt;get(ied,2);</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;            k11 = cosa-&gt;get(ied)*cosa-&gt;get(ied)/len;</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;            k12 = sina-&gt;get(ied)*cosa-&gt;get(ied)/len;</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;            k22 = sina-&gt;get(ied)*sina-&gt;get(ied)/len;</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;            ipx = 2*intfac-&gt;get(ied,2);</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;            ipy = 2*intfac-&gt;get(ied,2)+1;</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;            jpx = 2*intfac-&gt;get(ied,3);</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;            jpy = 2*intfac-&gt;get(ied,3)+1;</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;            <span class="comment">//scatter</span></div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;            <span class="keywordtype">double</span> temp;</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;<span class="preprocessor">            #pragma omp critical (omp_lineal)</span></div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;<span class="preprocessor"></span>            {</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;                temp = Kg.get(ipx,ipx);</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;                Kg.set(ipx,ipx, temp+k11);          <span class="comment">// contribution by x-displacement of ip node to x-force at ip node</span></div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;                temp = Kg.get(ipx,ipy);</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;                Kg.set(ipx,ipy, temp+k12);          <span class="comment">// contribution by y-displacement of ip node to x-force at ip node</span></div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;                temp = Kg.get(ipx,jpx);</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;                Kg.set(ipx,jpx,temp-k11);</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;                temp = Kg.get(ipx,jpy);</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;                Kg.set(ipx,jpy, temp-k12);</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;                temp = Kg.get(ipy,ipx);</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;                Kg.set(ipy,ipx, temp+k12);</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;                temp = Kg.get(ipy,ipy);</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;                Kg.set(ipy,ipy,temp+k22);</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;                temp = Kg.get(ipy,jpx);</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;                Kg.set(ipy,jpx, temp-k12);</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;                temp = Kg.get(ipy,jpy);</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;                Kg.set(ipy,jpy, temp-k22);</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;                temp = Kg.get(jpx,ipx);</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;                Kg.set(jpx,ipx, temp-k11);</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;                temp = Kg.get(jpx,ipy);</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;                Kg.set(jpx,ipy, temp-k12);</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;                temp = Kg.get(jpx,jpx);</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;                Kg.set(jpx,jpx, temp+k11);</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;                temp = Kg.get(jpx,jpy);</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;                Kg.set(jpx,jpy, temp+k12);</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;                Kg.set(jpy,ipx, Kg.get(jpy,ipx)-k12);</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;                Kg.set(jpy,ipy, Kg.get(jpy,ipy)-k22);</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;                Kg.set(jpy,jpx, Kg.get(jpy,jpx)+k12);</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;                Kg.set(jpy,jpy, Kg.get(jpy,jpy)+k22);</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;            }</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;            <span class="comment">//if(ied % 40 == 0)</span></div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;            <span class="comment">//  cout &lt;&lt; &quot;=&quot; &lt;&lt; flush;</span></div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;        }</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;        <span class="comment">// end parallel</span></div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;        cout &lt;&lt; endl;</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;UTriMesh: movemesh_farhat(): Done iterating over edges.\n&quot;</span>;</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;        <span class="comment">//Now for torsional stiffnesses</span></div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;        <span class="keywordtype">double</span> x12, x23, x31, y12, y23, y31, l12, l23, l31;</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;        <span class="keywordtype">int</span> px[3], py[3];       <span class="comment">// nnode = 3</span></div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;        <span class="keywordtype">int</span> iel;</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;        <span class="comment">//iterate over elements</span></div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;<span class="preprocessor">        #pragma omp parallel for default(none) private(iel,px,py,x12,x23,x31,y12,y23,y31,l12,l23,l31) shared(naface,nnode,nelem,jacobians,Kg) num_threads(nthreads_mesh)</span></div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;<span class="preprocessor"></span>        <span class="keywordflow">for</span>(iel = 0; iel &lt; nelem; iel++)</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;        {</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;            <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;double&gt;</a> R(3,6);</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;            <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;double&gt;</a> C(3,3); C.zeros();</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;            <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;double&gt;</a> Kt(6,6);     <span class="comment">//torsional element stiffness matrix</span></div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;            x12 = gcoords(ginpoel(iel,1),0) - gcoords(ginpoel(iel,0),0);</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;            x23 = gcoords(ginpoel(iel,2),0) - gcoords(ginpoel(iel,1),0);</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;            x31 = gcoords(ginpoel(iel,0),0) - gcoords(ginpoel(iel,2),0);</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;            y12 = gcoords(ginpoel(iel,1),1) - gcoords(ginpoel(iel,0),1);</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;            y23 = gcoords(ginpoel(iel,2),1) - gcoords(ginpoel(iel,1),1);</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;            y31 = gcoords(ginpoel(iel,0),1) - gcoords(ginpoel(iel,2),1);</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;            l12 = x12*x12 + y12*y12;</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;            l23 = x23*x23 + y23*y23;</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;            l31 = x31*x31 + y31*y31;</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;            R(0,0) = -y31/l31 - y12/l12; R(0,1) = x12/l12 + x31/l31; R(0,2) = y12/l12; R(0,3) = -x12/l12; R(0,4) = y31/l31; R(0,5) = -x31/l31;</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;            R(1,0) = y12/l12; R(1,1) = -x12/l12; R(1,2) = -y12/l12 - y23/l23; R(1,3) = x23/l23 + x12/l12; R(1,4) = y23/l23; R(1,5) = -x23/l23;</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;            R(2,0) = y31/l31; R(2,1) = -x31/l31; R(2,2) = y23/l23; R(2,3) = -x23/l23; R(2,4) = -y23/l23 - y31/l31; R(2,5) = x31/l31 + x23/l23;</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;            C(0,0) = l12*l31/(4.0*jacobians-&gt;get(iel)*jacobians-&gt;get(iel));</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;            C(1,1) = l12*l23/(4.0*jacobians-&gt;get(iel)*jacobians-&gt;get(iel));</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;            C(2,2) = l31*l23/(4.0*jacobians-&gt;get(iel)*jacobians-&gt;get(iel));</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;            Kt = R.trans()*(C*R);</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ii = 0; ii &lt; nnode; ii++)</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;            {</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;                px[ii] = 2*ginpoel(iel,ii);</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;                py[ii] = 2*ginpoel(iel,ii) + 1;</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;            }</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;            <span class="keywordtype">double</span>*** temps = <span class="keyword">new</span> <span class="keywordtype">double</span>**[nnode];</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; nnode; i++)</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;            {</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;                temps[i] = <span class="keyword">new</span> <span class="keywordtype">double</span>*[nnode];</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j = 0; j &lt; nnode; j++)</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;                    temps[i][j] = <span class="keyword">new</span> <span class="keywordtype">double</span>[4];</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;            }</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; nnode; i++)</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;            {</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j = 0; j &lt; nnode; j++)</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;                {</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;                    temps[i][j][0] = Kt.get(2*i,2*j);</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;                    temps[i][j][1] = Kt.get(2*i,2*j+1);</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;                    temps[i][j][2] = Kt.get(2*i+1,2*j);</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;                    temps[i][j][3] = Kt.get(2*i+1,2*j+1);</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;                }</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;            }</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;            <span class="comment">//Add contributions to global stiffness matrix</span></div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;<span class="preprocessor">            #pragma omp critical (omp_torsion)</span></div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;<span class="preprocessor"></span>            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; nnode; i++)</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;            {</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j = 0; j &lt; nnode; j++)</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;                {</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;                    Kg.set(px[i],px[j], Kg.get(px[i],px[j])+ temps[i][j][0] );</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;                    Kg.set(px[i],py[j], Kg.get(px[i],py[j])+ temps[i][j][1] );</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;                    Kg.set(py[i],px[j], Kg.get(py[i],px[j])+ temps[i][j][2] );</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;                    Kg.set(py[i],py[j], Kg.get(py[i],py[j])+ temps[i][j][3] );</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;                }</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;            }</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; nnode; i++)</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;            {</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j = 0; j &lt; nnode; j++)</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;                    <span class="keyword">delete</span> [] temps[i][j];</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;                <span class="keyword">delete</span> [] temps[i];</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;            }</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;            <span class="keyword">delete</span> [] temps;</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;            <span class="comment">//if(iel%40==0)</span></div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;            <span class="comment">//  cout &lt;&lt; &quot;=&quot; &lt;&lt; flush;</span></div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;        }</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;        <span class="comment">// end parallel</span></div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;        cout &lt;&lt; endl;</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;UTriMesh: movemesh_farhat(): Stiffness matrix assembled.\n&quot;</span>;</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;        setbflags2();</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;UTriMesh: movemesh_farhat(): bflags2 calculated.\n&quot;</span>;</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;        <span class="comment">//Set boundary condtions</span></div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;        <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;double&gt;</a> b(2*npoin,1);</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; 2*npoin; i=i+2)</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;        {</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;            b(i) = xb-&gt;get(i/2);</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;            b(i+1) = yb-&gt;get(i/2);</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;        }</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;        <span class="keywordtype">double</span> cbig = 1e30;         <span class="comment">// big number for Dirichlet BCs</span></div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;        <span class="comment">// apply Dirichlet BCs using cbig</span></div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; 2*nbpoin; i++)</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;        {</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;            <span class="comment">//if(bflag2(i,0) == 1)</span></div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;            {</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;                b(i,0) *= (cbig * Kg.get(i,i));</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;                Kg.set(i,i, Kg.get(i,i)*cbig);</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;            }</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;        }</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;UTriMesh: movemesh_farhat(): BCs set.\n&quot;</span>;</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;        <span class="comment">//Solve</span></div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;movemesh_farhat: Solving mesh-movement equations\n&quot;</span>;</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;        <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;double&gt;</a> dr(2*npoin,1);</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;        <a class="code" href="classamat_1_1Matrix.html">Matrix&lt;double&gt;</a> initvals(2*npoin,1);</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;        initvals.zeros();</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;        dr = <a class="code" href="namespaceamat.html#a88aef55ee9b1b5e9f9540fd143bd19a6">sparseCG_d</a>(&amp;Kg, b, initvals, tol, maxiter);</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;movemesh_farhat: Mesh-movement equations solved.\n&quot;</span>;</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;        <span class="comment">//update coordinates</span></div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; npoin; i++)</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;        {</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;            coords(i,0) += dr(2*i);</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;            coords(i,1) += dr(2*i+1);</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;        }</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;        <span class="comment">//update jacobians</span></div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;        compute_jacobians();</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;        <span class="comment">// Also need to update length of faces, normals to faces in gallfa</span></div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;        compute_lengths_and_normals();</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;        compute_edge_angles();</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;    }</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;    <span class="comment">/*double farhat_assemble(int a, int b)</span></div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;<span class="comment">    {</span></div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;<span class="comment">        double val = 0;</span></div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;<span class="comment">        //cout &lt;&lt; &quot;UTriMesh: farhat_assemble(): Starting\n&quot;;</span></div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;<span class="comment">        //Matrix&lt;double&gt; Kg(2*npoin,2*npoin);       // global stiffness matrix</span></div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;<span class="comment">        //Kg.zeros();</span></div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;<span class="comment">        //Matrix&lt;double&gt; kli(4,4);              // lineal stiffness matrix for an edge (face in 2D)</span></div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;<span class="comment">        double k11, k12, k22;</span></div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;<span class="comment">        double len;</span></div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;<span class="comment">        int ipx, ipy, jpx, jpy;</span></div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;<span class="comment">        for(int ied = 0; ied &lt; naface; ied++)</span></div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;<span class="comment">        {</span></div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;<span class="comment">            ipx = 2*intfac(ied,2);</span></div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;<span class="comment">            ipy = 2*intfac(ied,2)+1;</span></div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;<span class="comment">            jpx = 2*intfac(ied,3);</span></div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;<span class="comment">            jpy = 2*intfac(ied,3)+1;</span></div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;<span class="comment">            if((ipx != a &amp;&amp; ipy != a &amp;&amp; jpx != a &amp;&amp; jpy != a) || (ipx != b &amp;&amp; ipy != b &amp;&amp; jpx != b &amp;&amp; jpy != b)) continue;</span></div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;<span class="comment">            //gather</span></div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;<span class="comment">            len = gallfa(ied,2);</span></div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;<span class="comment">            k11 = cosa(ied)*cosa(ied)/len;</span></div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;<span class="comment">            k12 = sina(ied)*cosa(ied)/len;</span></div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;<span class="comment">            k22 = sina(ied)*sina(ied)/len;</span></div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;<span class="comment">            //scatter</span></div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;<span class="comment">            if(ipx==a &amp;&amp; ipx==b) val += k11;            // contribution by x-displacement of ip node to x-force at ip node</span></div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;<span class="comment">            if(ipx==a &amp;&amp; ipy==b) val += k12;            // contribution by y-displacement of ip node to x-force at ip node</span></div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;<span class="comment">            if(ipx==a &amp;&amp; jpx==b) val += -k11;</span></div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;<span class="comment">            if(ipx==a &amp;&amp; jpy==b) val += -k12;</span></div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;<span class="comment">            if(ipy==a &amp;&amp; ipx==b) val += k12;</span></div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;<span class="comment">            if(ipy==a &amp;&amp; ipy==b) val += k22;</span></div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;<span class="comment">            if(ipy==a &amp;&amp; jpx==b) val += -k12;</span></div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;<span class="comment">            if(ipy==a &amp;&amp; jpy==b) val += -k22;</span></div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;<span class="comment">            if(jpx==a &amp;&amp; ipx==b) val += -k11;</span></div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;<span class="comment">            if(jpx==a &amp;&amp; ipy==b) val += -k12;</span></div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;<span class="comment">            if(jpx==a &amp;&amp; jpx==b) val += k11;</span></div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;<span class="comment">            if(jpx==a &amp;&amp; jpy==b) val += k12;</span></div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;<span class="comment">            if(jpy==a &amp;&amp; ipx==b) val += -k12;</span></div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;<span class="comment">            if(jpy==a &amp;&amp; ipy==b) val += -k22;</span></div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;<span class="comment">            if(jpy==a &amp;&amp; jpx==b) val += k12;</span></div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;<span class="comment">            if(jpy==a &amp;&amp; jpy==b) val += k22;</span></div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;<span class="comment">        //cout &lt;&lt; &quot;UTriMesh: farhat_assemble(): Done iterating over edges.\n&quot;;</span></div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;<span class="comment">        //Now for torsional stiffnesses</span></div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;<span class="comment">        Matrix&lt;double&gt; R(3,6);</span></div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;<span class="comment">        Matrix&lt;double&gt; C(3,3); C.zeros();</span></div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;<span class="comment">        Matrix&lt;double&gt; Kt(6,6);     //torsional element stiffness matrix</span></div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;<span class="comment">        double x12, x23, x31, y12, y23, y31, l12, l23, l31;</span></div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;<span class="comment">        int px[3], py[3];       // nnode = 3</span></div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;<span class="comment">        bool cha = false, chb=false;</span></div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;<span class="comment">        //iterate over elements</span></div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;<span class="comment">        for(int iel = 0; iel &lt; nelem; iel++)</span></div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;<span class="comment">        {</span></div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;<span class="comment">            for(int i = 0; i &lt; nnode; i++)</span></div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;<span class="comment">            {</span></div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;<span class="comment">                px[i] = 2*inpoel(iel,i);</span></div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;<span class="comment">                py[i] = 2*inpoel(iel,i) + 1;</span></div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;<span class="comment">                if(px[i]==a || py[i] == a) cha = true; if(px[i]==b || py[i]==b) chb = true;</span></div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;<span class="comment">            }</span></div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;<span class="comment">            if(cha==false || chb==false) continue;</span></div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;<span class="comment">            x12 = gcoords(ginpoel(iel,1),0) - gcoords(ginpoel(iel,0),0);</span></div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;<span class="comment">            x23 = gcoords(ginpoel(iel,2),0) - gcoords(ginpoel(iel,1),0);</span></div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;<span class="comment">            x31 = gcoords(ginpoel(iel,0),0) - gcoords(ginpoel(iel,2),0);</span></div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;<span class="comment">            y12 = gcoords(ginpoel(iel,1),1) - gcoords(ginpoel(iel,0),1);</span></div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;<span class="comment">            y23 = gcoords(ginpoel(iel,2),1) - gcoords(ginpoel(iel,1),1);</span></div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;<span class="comment">            y31 = gcoords(ginpoel(iel,0),1) - gcoords(ginpoel(iel,2),1);</span></div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;<span class="comment">            l12 = x12*x12 + y12*y12;</span></div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;<span class="comment">            l23 = x23*x23 + y23*y23;</span></div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;<span class="comment">            l31 = x31*x31 + y31*y31;</span></div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;<span class="comment">            R(0,0) = -y31/l31 - y12/l12; R(0,1) = x12/l12 + x31/l31; R(0,2) = y12/l12; R(0,3) = -x12/l12; R(0,4) = y31/l31; R(0,5) = -x31/l31;</span></div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;<span class="comment">            R(1,0) = y12/l12; R(1,1) = -x12/l12; R(1,2) = -y12/l12 - y23/l23; R(1,3) = x23/l23 + x12/l12; R(1,4) = y23/l23; R(1,5) = -x23/l23;</span></div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;<span class="comment">            R(2,0) = y31/l31; R(2,1) = -x31/l31; R(2,2) = y23/l23; R(2,3) = -x23/l23; R(2,4) = -y23/l23 - y31/l31; R(2,5) = x31/l31 + x23/l23;</span></div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;<span class="comment">            C(0,0) = l12*l31/(4.0*jacobians(iel)*jacobians(iel));</span></div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;<span class="comment">            C(1,1) = l12*l23/(4.0*jacobians(iel)*jacobians(iel));</span></div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;<span class="comment">            C(2,2) = l31*l23/(4.0*jacobians(iel)*jacobians(iel));</span></div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;<span class="comment">            Kt = R.trans()*(C*R);</span></div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;<span class="comment">            //Add contributions to global stiffness matrix</span></div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;<span class="comment">            for(int i = 0; i &lt; nnode; i++)</span></div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;<span class="comment">                for(int j = 0; j &lt; nnode; j++)</span></div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;<span class="comment">                {</span></div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;<span class="comment">                    if(px[i]==a &amp;&amp; px[j]==b) val += Kt(2*i,2*j);</span></div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;<span class="comment">                    if(px[i]==a &amp;&amp; py[j]==b) val += Kt(2*i,2*j+1);</span></div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;<span class="comment">                    if(py[i]==a &amp;&amp; px[j]==b) val += Kt(2*i+1,2*j);</span></div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;<span class="comment">                    if(py[i]==a &amp;&amp; py[j]==b) val += Kt(2*i+1,2*j+1);</span></div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;<span class="comment">                }</span></div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;<span class="comment">        //cout &lt;&lt; &quot;UTriMesh: movemesh_farhat(): Stiffness matrix assembled.\n&quot;;</span></div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;<span class="comment">        //BCs</span></div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;<span class="comment">        double cbig = 1e-30;        // big number for Dirichlet BCs</span></div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;<span class="comment">        if(a==b &amp;&amp; a/2 &lt; nbpoin) val *= cbig;</span></div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;<span class="comment">        return val;</span></div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;<span class="comment">    double farhatRHS(int a)</span></div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;<span class="comment">    {</span></div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;<span class="comment">        // Note that the x- and y-components in the resulting nodal displacements are interleaved in the vector dr, while the input boundary displacements are not interleaved - xb and yb are taken separately</span></div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;<span class="comment">        double val = 0;</span></div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;<span class="comment">        //Set boundary condtions</span></div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;<span class="comment">        if(a%2 == 0)</span></div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;<span class="comment">            val = (*xb)(a/2);</span></div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;<span class="comment">        else</span></div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;<span class="comment">            val = (*yb)(a/2);</span></div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;<span class="comment">        // apply Dirichlet BCs using cbig</span></div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;<span class="comment">        if(a/2 &lt; nbpoin)</span></div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;<span class="comment">            val *= farhat_assemble(a,a);</span></div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;<span class="comment">        //cout &lt;&lt; &quot;UTriMesh: movemesh_farhat(): BCs set.\n&quot;;</span></div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;<span class="comment">        return val;</span></div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;<span class="comment">    void movemesh_farhat(string solver, double tol=1e-6, int maxiter=1000)</span></div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;<span class="comment">    {</span></div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;<span class="comment">        //Solve</span></div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;<span class="comment">        cout &lt;&lt; &quot;movemesh_farhat: Solving mesh-movement equations\n&quot;;</span></div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;<span class="comment">        Matrix&lt;double&gt; dr(2*npoin,1);</span></div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;<span class="comment">        Matrix&lt;double&gt; initvals(2*npoin,1);</span></div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;<span class="comment">        initvals.zeros();</span></div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;<span class="comment">        dr = gaussseidel_ng(2*npoin, 2*npoin, 2*npoin, initvals, tol, maxiter, &#39;n&#39;);</span></div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;<span class="comment">        cout &lt;&lt; &quot;movemesh_farhat: Mesh-movement equations solved.\n&quot;;</span></div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;<span class="comment">        //update coordinates</span></div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;<span class="comment">        for(int i = 0; i &lt; npoin; i++)</span></div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;<span class="comment">        {</span></div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;<span class="comment">            coords(i,0) += dr(2*i);</span></div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;<span class="comment">            coords(i,1) += dr(2*i+1);</span></div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;<span class="comment">        //update jacobians</span></div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;<span class="comment">        compute_jacobians();</span></div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;<span class="comment">        // Also need to update length of faces, normals to faces in gallfa</span></div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;<span class="comment">        compute_lengths_and_normals();</span></div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;<span class="comment">        compute_edge_angles();</span></div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;<span class="comment">    Matrix&lt;double&gt; gaussseidel_ng(int arows, int acols, int brows, Matrix&lt;double&gt; xold, double tol, int maxiter, char check)</span></div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;<span class="comment">    {</span></div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;<span class="comment">        cout &lt;&lt; &quot;\ngaussseidel: Input LHS matrix is &quot; &lt;&lt; arows &lt;&lt; &quot; x &quot; &lt;&lt; acols &lt;&lt; endl;</span></div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;<span class="comment">        Matrix&lt;double&gt; bb;      // dummy</span></div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;<span class="comment">        if(arows != acols) { cout &lt;&lt; &quot;! gaussseidel: Invalid dimensions of A and b!\n&quot;; return bb; }</span></div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;<span class="comment">        if(xold.rows() != brows) { cout &lt;&lt; &quot;! gaussseidel: Invalid dimensions on xold !\n&quot;; return bb; }</span></div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;<span class="comment">        int N = arows;</span></div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;<span class="comment">        if(check == &#39;y&#39;)</span></div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;<span class="comment">        {</span></div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;<span class="comment">            for(int i = 0; i &lt; arows; i++)</span></div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;<span class="comment">            {</span></div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;<span class="comment">                double sum = 0;</span></div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;<span class="comment">                for(int j = 0; j &lt; acols; j++)</span></div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;<span class="comment">                {</span></div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;<span class="comment">                    if(i != j) sum += dabs(farhat_assemble(i,j));</span></div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;<span class="comment">                }</span></div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;<span class="comment">                if(dabs(farhat_assemble(i,i)) &lt;= sum) cout &lt;&lt; &quot;* gaussseidel: LHS Matrix is NOT strictly diagonally dominant in row &quot; &lt;&lt; i &lt;&lt; &quot;!!\n&quot;;</span></div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;<span class="comment">            }</span></div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;<span class="comment">        Matrix&lt;double&gt; x(brows,1);</span></div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;<span class="comment">        Matrix&lt;double&gt; M(N,1);      // diagonal elements of A</span></div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;<span class="comment">        M.zeros();</span></div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;<span class="comment">        //populate diagonal matrix M</span></div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;<span class="comment">        cout &lt;&lt; &quot;gaussseidel_ng: populate diagonal matrix M\n&quot;;</span></div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;<span class="comment">        for(int i = 0; i &lt; N; i++)</span></div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;<span class="comment">            M(i) = farhat_assemble(i,i);</span></div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;<span class="comment">        //A = A - M;</span></div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;<span class="comment">        //invert M</span></div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;<span class="comment">        cout &lt;&lt; &quot;gaussseidel_ng: invert M\n&quot;;</span></div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;<span class="comment">        for(int i = 0; i &lt; N; i++)</span></div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;<span class="comment">            M(i) = 1.0/M(i);</span></div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;<span class="comment">        //x.zeros();</span></div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;<span class="comment">        //cout &lt;&lt; &quot;gaussseidel: Initial error = &quot; &lt;&lt; (xold-x).dabsmax() &lt;&lt; endl;</span></div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;<span class="comment">        x = xold;</span></div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;<span class="comment">        int c = 0;</span></div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;<span class="comment">        double initres;</span></div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;<span class="comment">        bool first = true;</span></div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;<span class="comment">        Matrix&lt;double&gt; Axold(N,1);</span></div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;<span class="comment">        Matrix&lt;double&gt; inter(N,1);</span></div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;<span class="comment">        Matrix&lt;double&gt; diff(N,1);   // diff = x - xold</span></div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;<span class="comment">        double error = 1.0;</span></div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;<span class="comment">        cout &lt;&lt; &quot;gaussseidel_ng: Start iterations\n&quot;;</span></div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;<span class="comment">        do</span></div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;<span class="comment">        {</span></div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;<span class="comment">            xold = x;</span></div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;<span class="comment">            Axold.zeros();</span></div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;<span class="comment">            for(int i = 0; i &lt; N; i++)</span></div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;<span class="comment">            {</span></div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;<span class="comment">                for(int k = 0; k &lt; i; k++)</span></div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;<span class="comment">                    Axold(i,0) += farhat_assemble(i,k)*x(k,0);</span></div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;<span class="comment">                Axold(i,0) += 0*xold(i,0);</span></div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;<span class="comment">                for(int k = i+1; k &lt; N; k++)</span></div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;<span class="comment">                    Axold(i,0) += farhat_assemble(i,k)*xold(k,0);</span></div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;<span class="comment">                inter(i,0) = farhatRHS(i) - Axold(i,0);</span></div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;<span class="comment">                x(i,0) = M(i,i) * inter(i,0);</span></div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;<span class="comment">            }</span></div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;<span class="comment">            // NOTE: The above results in FORWARD Gauss-Seidel</span></div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;<span class="comment">            c++;</span></div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;<span class="comment">            if(c &gt; maxiter) { cout &lt;&lt; &quot;gaussseidel: Max iterations exceeded!\n&quot;; break; }</span></div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;<span class="comment">            for(int i = 0; i &lt; N; i++)</span></div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;<span class="comment">                diff(i,0) = x(i,0) - xold(i,0);</span></div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;<span class="comment">            error = dabs(diff(0,0));</span></div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;<span class="comment">            for(int i = 1; i &lt; N; i++)</span></div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;<span class="comment">                if(dabs(diff(i,0)) &gt; error) error = dabs(diff(i,0));</span></div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;<span class="comment">            //cout &lt;&lt; &quot;gaussseidel: error = &quot; &lt;&lt; error &lt;&lt; endl;</span></div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;<span class="comment">            if(first == true)</span></div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;<span class="comment">            {   initres = error;</span></div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;<span class="comment">                cout &lt;&lt; &quot;gausssiedel: Initial residue = &quot; &lt;&lt; initres &lt;&lt; endl;</span></div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;<span class="comment">                first = false;</span></div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;<span class="comment">            }</span></div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;<span class="comment">            //if(c%10 == 0)</span></div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;<span class="comment">                cout &lt;&lt; &quot;gausssiedel(): Step &quot; &lt;&lt; c &lt;&lt; &quot;, Relative error = &quot; &lt;&lt; error/initres &lt;&lt; endl;</span></div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;<span class="comment">        } while(error/initres &gt;= tol);</span></div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;<span class="comment">        cout &lt;&lt; &quot;gaussseidel: No. of iterations = &quot; &lt;&lt; c &lt;&lt; endl;</span></div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;<span class="comment">        return x;</span></div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;<span class="comment">    }*/</span></div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;};</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;} <span class="comment">// end namespace acfd</span></div>
<div class="ttc" id="namespaceamat_html_a2792c2bc650a2476343c001056620f0e"><div class="ttname"><a href="namespaceamat.html#a2792c2bc650a2476343c001056620f0e">amat::cholesky</a></div><div class="ttdeci">Matrix&lt; double &gt; cholesky(Matrix&lt; double &gt; A, Matrix&lt; double &gt; b)</div><div class="ttdoc">Old (somewhat tested) implementation of Cholesky direct solver. </div><div class="ttdef"><b>Definition:</b> alinalg.cpp:24</div></div>
<div class="ttc" id="namespaceamat_html_aa4ae493e01024d481b1ee27d5c79d6c6"><div class="ttname"><a href="namespaceamat.html#aa4ae493e01024d481b1ee27d5c79d6c6">amat::gaussseidel</a></div><div class="ttdeci">Matrix&lt; double &gt; gaussseidel(Matrix&lt; double &gt; A, Matrix&lt; double &gt; b, Matrix&lt; double &gt; xold, double tol, int maxiter, char check)</div><div class="ttdoc">Solves Ax = b for dense A by forward Gauss-Seidel iterations. </div><div class="ttdef"><b>Definition:</b> alinalg.cpp:475</div></div>
<div class="ttc" id="classamat_1_1Matrix_html_a6d05d3393c5f98780f91daf9d2bbf82a"><div class="ttname"><a href="classamat_1_1Matrix.html#a6d05d3393c5f98780f91daf9d2bbf82a">amat::Matrix::setup</a></div><div class="ttdeci">void setup(int nr, int nc, MStype st=ROWMAJOR)</div><div class="ttdoc">Separate setup function in case no-arg constructor has to be used. </div><div class="ttdef"><b>Definition:</b> amatrix2.hpp:179</div></div>
<div class="ttc" id="amatrix2_8hpp_html"><div class="ttname"><a href="amatrix2_8hpp.html">amatrix2.hpp</a></div><div class="ttdoc">Defines a class to manipulate matrices. </div></div>
<div class="ttc" id="asparsematrix_8hpp_html"><div class="ttname"><a href="asparsematrix_8hpp.html">asparsematrix.hpp</a></div><div class="ttdoc">Sparse storage schemes for matrices (header-only library) </div></div>
<div class="ttc" id="namespaceamat_html_aa656601bbd4193d1d21a150dc26d9923"><div class="ttname"><a href="namespaceamat.html#aa656601bbd4193d1d21a150dc26d9923">amat::pointjacobi</a></div><div class="ttdeci">Matrix&lt; double &gt; pointjacobi(Matrix&lt; double &gt; A, Matrix&lt; double &gt; b, Matrix&lt; double &gt; xold, double tol, int maxiter, char check)</div><div class="ttdoc">Solves Ax = b for dense A by point-Jacobi iterations. </div><div class="ttdef"><b>Definition:</b> alinalg.cpp:421</div></div>
<div class="ttc" id="classamat_1_1Matrix_html"><div class="ttname"><a href="classamat_1_1Matrix.html">amat::Matrix&lt; double &gt;</a></div></div>
<div class="ttc" id="namespaceamat_html_afae9ae0c89f02718f6e68d3e5d3960ac"><div class="ttname"><a href="namespaceamat.html#afae9ae0c89f02718f6e68d3e5d3960ac">amat::gausselim</a></div><div class="ttdeci">void gausselim(Matrix&lt; double &gt; &amp;A, Matrix&lt; double &gt; &amp;b, Matrix&lt; double &gt; &amp;x)</div><div class="ttdoc">Computes solution of Ax = b by Gaussian elimination. Reasonably well-tested. </div><div class="ttdef"><b>Definition:</b> alinalg.cpp:201</div></div>
<div class="ttc" id="classamat_1_1MatrixCRS_html"><div class="ttname"><a href="classamat_1_1MatrixCRS.html">amat::MatrixCRS&lt; double &gt;</a></div></div>
<div class="ttc" id="namespaceamat_html_a88aef55ee9b1b5e9f9540fd143bd19a6"><div class="ttname"><a href="namespaceamat.html#a88aef55ee9b1b5e9f9540fd143bd19a6">amat::sparseCG_d</a></div><div class="ttdeci">Matrix&lt; double &gt; sparseCG_d(SpMatrix *A, Matrix&lt; double &gt; b, Matrix&lt; double &gt; xold, double tol, int maxiter)</div><div class="ttdoc">Calculates solution of Ax=b where A is a SPD matrix in sparse format. This function is well-tested...</div><div class="ttdef"><b>Definition:</b> alinalg.cpp:747</div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
